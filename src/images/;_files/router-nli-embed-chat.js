webpackJsonp([42],{0:function(t,e,n){"use strict";var i=n(650),o=n(146),r=n(59),s=n(6);n(468),n(607),n(608),n(636),n(84),n(609),n(471),n(258);var a=new o.ChatCollection(null,{listen:!0});a.on("add",function(t){setTimeout(t.set.bind(t,"unread",!1),500)}),r(function(){var t=new i({template:!1,el:"body",chatCollection:a});t.render(),s("#login").click(function(t){t.preventDefault(),window.open("/login?action=signup&source=embedded&returnTo=/login/embed","","width=1100, height=600")})}),window.addEventListener("message",function(t){t.origin===location.origin&&"login_complete"===t.data&&(location.hash="#autojoin",location.reload())})},57:function(t,e){"use strict";function n(t){return window.setTimeout(t,1e3/60)}function i(t){window.clearTimeout(t)}var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,r=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame;t.exports=o&&o.bind(window)||n,t.exports.cancel=r&&r.bind(window)||i},59:function(t,e){"use strict";function n(t,e,n,i){t.addEventListener(e,this,!1),this.handleEvent=function(o){t.removeEventListener(e,this,!1),n.call(i,o)}}t.exports=function(t,e){new n(window,"DOMContentLoaded",t,e)}},60:function(t,e){"use strict";var n=function(t,e,n){var i=n;if(t.classList)3===arguments.length?n?t.classList.add(e):t.classList.remove(e):i=t.classList.toggle(e);else if(t.getAttribute){var o=t.getAttribute("class"),r=o.replace(new RegExp("(^|\\s)"+e+"($|\\s)"),"");n||o===r?t.setAttribute("class",r+" "+e):t.setAttribute("class",r)}return i};t.exports=n},65:function(t,e,n){(function(e){"use strict";function i(t){t=t||e.location||{};var n,i={},o=typeof t;if("blob:"===t.protocol)i=new s(unescape(t.pathname),{});else if("string"===o){i=new s(t,{});for(n in m)delete i[n]}else if("object"===o){for(n in t)n in m||(i[n]=t[n]);void 0===i.slashes&&(i.slashes=d.test(t.href))}return i}function o(t){var e=h.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function r(t,e){for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),i=n.length,o=n[i-1],r=!1,s=0;i--;)"."===n[i]?n.splice(i,1):".."===n[i]?(n.splice(i,1),s++):s&&(0===i&&(r=!0),n.splice(i,1),s--);return r&&n.unshift(""),"."!==o&&".."!==o||n.push(""),n.join("/")}function s(t,e,n){if(!(this instanceof s))return new s(t,e,n);var a,l,h,d,m,p,g=f.slice(),v=typeof e,_=this,w=0;for("object"!==v&&"string"!==v&&(n=e,e=null),n&&"function"!=typeof n&&(n=u.parse),e=i(e),l=o(t||""),a=!l.protocol&&!l.slashes,_.slashes=l.slashes||a&&e.slashes,_.protocol=l.protocol||e.protocol||"",t=l.rest,l.slashes||(g[2]=[/(.*)/,"pathname"]);w<g.length;w++)d=g[w],h=d[0],p=d[1],h!==h?_[p]=t:"string"==typeof h?~(m=t.indexOf(h))&&("number"==typeof d[2]?(_[p]=t.slice(0,m),t=t.slice(m+d[2])):(_[p]=t.slice(m),t=t.slice(0,m))):(m=h.exec(t))&&(_[p]=m[1],t=t.slice(0,m.index)),_[p]=_[p]||(a&&d[3]?e[p]||"":""),d[4]&&(_[p]=_[p].toLowerCase());n&&(_.query=n(_.query)),a&&e.slashes&&"/"!==_.pathname.charAt(0)&&(""!==_.pathname||""!==e.pathname)&&(_.pathname=r(_.pathname,e.pathname)),c(_.port,_.protocol)||(_.host=_.hostname,_.port=""),_.username=_.password="",_.auth&&(d=_.auth.split(":"),_.username=d[0]||"",_.password=d[1]||""),_.origin=_.protocol&&_.host&&"file:"!==_.protocol?_.protocol+"//"+_.host:"null",_.href=_.toString()}function a(t,e,n){var i=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||u.parse)(e)),i[t]=e;break;case"port":i[t]=e,c(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="");break;case"hostname":i[t]=e,i.port&&(e+=":"+i.port),i.host=e;break;case"host":i[t]=e,/:\d+$/.test(e)?(e=e.split(":"),i.port=e.pop(),i.hostname=e.join(":")):(i.hostname=e,i.port="");break;case"protocol":i.protocol=e.toLowerCase(),i.slashes=!n;break;case"pathname":i.pathname=e.length&&"/"!==e.charAt(0)?"/"+e:e;break;default:i[t]=e}for(var o=0;o<f.length;o++){var r=f[o];r[4]&&(i[r[1]]=i[r[1]].toLowerCase())}return i.origin=i.protocol&&i.host&&"file:"!==i.protocol?i.protocol+"//"+i.host:"null",i.href=i.toString(),i}function l(t){t&&"function"==typeof t||(t=u.stringify);var e,n=this,i=n.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var o=i+(n.slashes?"//":"");return n.username&&(o+=n.username,n.password&&(o+=":"+n.password),o+="@"),o+=n.host+n.pathname,e="object"==typeof n.query?t(n.query):n.query,e&&(o+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(o+=n.hash),o}var c=n(66),u=n(67),h=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,d=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,f=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],m={hash:1,query:1};s.prototype={set:a,toString:l},s.extractProtocol=o,s.location=i,s.qs=u,t.exports=s}).call(e,function(){return this}())},66:function(t,e){"use strict";t.exports=function(t,e){if(e=e.split(":")[0],t=+t,!t)return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},67:function(t,e){"use strict";function n(t){return decodeURIComponent(t.replace(/\+/g," "))}function i(t){for(var e,i=/([^=?&]+)=?([^&]*)/g,o={};e=i.exec(t);o[n(e[1])]=n(e[2]));return o}function o(t,e){e=e||"";var n=[];"string"!=typeof e&&(e="?");for(var i in t)r.call(t,i)&&n.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return n.length?e+n.join("&"):""}var r=Object.prototype.hasOwnProperty;e.stringify=o,e.parse=i},68:function(t,e){"use strict";t.exports={currentView:null,show:function(t){if(this.currentView){var e=this.currentView;e.hideInternal()}this.currentView=t,t.navigable=!0,t.show(),this.currentView.listenTo(this.currentView,"hide-modal",this.destroy.bind(this))},destroy:function(){this.currentView&&(this.currentView.navigationalHide(),this.currentView=null)}}},81:function(t,e,n){var i,o;!function(){"use strict";function n(){for(var t=[],e=0;e<arguments.length;e++){var i=arguments[e];if(i){var o=typeof i;if("string"===o||"number"===o)t.push(i);else if(Array.isArray(i))t.push(n.apply(null,i));else if("object"===o)for(var s in i)r.call(i,s)&&i[s]&&t.push(s)}}return t.join(" ")}var r={}.hasOwnProperty;"undefined"!=typeof t&&t.exports?t.exports=n:(i=[],o=function(){return n}.apply(e,i),!(void 0!==o&&(t.exports=o)))}()},83:function(t,e){"use strict";var n=!!navigator.userAgent.match(/(iPhone|iPod|Android|BlackBerry)/);t.exports=function(){return n}},84:function(t,e,n){"use strict";var i=n(72)["default"],o=n(85),r=n(90),s=n(91);i.registerHelper("cdn",o),i.registerHelper("widget",r),i.registerHelper("avatarSrcSet",s)},85:function(t,e,n){"use strict";function i(){return n("file:"===window.location.protocol?86:r.length?1===r.length?88:89:87)}var o=n(47),r=o.cdns,s=o.assetTag,a=s?"/_s/"+s:"",l=i(),c={emailBasePath:null,webBasepath:null,hosts:r,cdnPrefix:a};t.exports=l(c)},86:function(t,e){"use strict";function n(){return function(t){return t||(t=""),"../"+t}}t.exports=n},87:function(t,e){"use strict";function n(t){var e=t.emailBasePath,n=t.webBasepath;return t.emailBasePath&&t.webBasepath?function(t,i){return t||(t=""),i&&i.email?e+"/_s/l/"+t:i&&i.nonrelative?n+"/_s/l/"+t:i&&i.notStatic?"/"+t:"/_s/l/"+t}:function(t,e){if(t||(t=""),e&&e.email)throw new Error("emailBasePath not supplied");return e&&e.notStatic?"/"+t:"/_s/l/"+t}}t.exports=n},88:function(t,e){"use strict";function n(t){var e=t.emailBasePath,n=t.hosts[0],i=t.cdnPrefix;return function(t,o){t||(t="");var r=o&&o.nonrelative,s=o&&o.email;if(s){if(!e)throw new Error("emailBasePath not supplied");return e+"/_s/l/"+t}var a=r?"https://":"//";return o&&o.longTermCache?a+n+"/_s/lt/"+o.longTermCache+"/"+t:o&&o.notStatic===!0?a+n+"/"+t:a+n+i+"/"+t}}t.exports=n},89:function(t,e){"use strict";function n(t){var e=t.emailBasePath,n=t.hosts,i=n.length,o=t.cdnPrefix;return function(t,r){if(t||(t=""),r&&r.email){if(!e)throw new Error("emailBasePath not supplied");return e+"/_s/l/"+t}for(var s=0,a=0;a<t.length;a+=3)s+=t.charCodeAt(a);var l=n[s%i],c=r&&r.nonrelative?"https://":"//";return r&&r.longTermCache?c+l+"/_s/lt/"+r.longTermCache+"/"+t:r&&r.notStatic===!0?c+l+"/"+t:c+l+o+"/"+t}}t.exports=n},90:function(t,e,n){"use strict";function i(t,e){var n=r++,i=this.getPrerendered(t,e.hash,n);return this.prerenderedViews||(this.prerenderedViews={}),this.prerenderedViews[n]={widgetName:t,model:e.hash},new o.SafeString(i)}var o=n(72)["default"],r=1;t.exports=i},91:function(t,e,n){"use strict";function i(t,e){if(!t)return" height='"+e+"' width='"+e+"' src='"+r.getDefault()+"'";var n=o(t,!0);n.query.s=e;var i=o(t,!0);i.query.s=2*e;var s=n.toString(),a=i.toString()+" 2x";return" height='"+e+"' width='"+e+"' src='"+s+"' srcset='"+a+"' "}var o=n(65),r=n(92);t.exports=i},92:function(t,e,n){"use strict";function i(t){return d("/gh/u/"+t)}function o(t){return d("/gravatar/e/"+t)}function r(t){var e=f(t);return e?d("/tw/i/"+e.id+"/"+e.filename):m}function s(t){return t?d("/group/i/"+t):null}function a(t){if(!t)return null;var e=t.id;return e?t.avatarVersion?d("/group/iv/"+t.avatarVersion+"/"+e):s(e):null}function l(t){if(!t)return null;var e=t.split("/")[0];return d("/gh/u/"+e)}function c(t){if(!t)return null;var e=t.username;if(!e)return null;var n=t.gv;return d(h(t)?n?"/gh/uv/"+n+"/"+e:"/gh/u/"+e:"/g/u/"+e)}function u(){return m}var h=n(93),d=n(94),f=n(95),m=n(96);t.exports={getForGitHubUsername:i,getForGravatarEmail:o,getForTwitterUrl:r,getForGroupId:s,getForGroup:a,getForRoomUri:l,getForUser:c,getDefault:u}},93:function(t,e){"use strict";function n(t){return!(!t||!t.username||t.type&&"github"!==t.type)&&!(t.username.indexOf("_")>=0)}t.exports=n},94:function(t,e,n){"use strict";function i(t){var e=0;if(!t.length)return e;var n=t.length-10;n<0&&(n=0);for(var i=n;i<t.length;i++){var o=t.charCodeAt(i);e=(e<<5)-e+o,e&=e}return e<0?-e:e}function o(t){if(s.length<2)return s[0]+t;var e=i(t);return s[e%s.length]+t}var r=n(47),s=r.avatarCdns;t.exports=o},95:function(t,e){"use strict";function n(t){if(0!==t.indexOf(i))return null;var e=t.slice(i.length),n=e.slice(0,e.indexOf("/")),o=e.slice(e.indexOf("/")+1);return{id:n,filename:o}}var i="https://pbs.twimg.com/profile_images/";t.exports=n},96:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACABAMAAAAxEHz4AAAAKlBMVEX8/Pz19fXe39/x8fH////i4+Pq6+vm5+fq6urz8/Ph4uLn6Oj39/fk5eW+lbN7AAAAhklEQVR4Ae3YNwGCMRBH8SABJOCAIuFvgGKAYoCigA0Jt7KxMiPhJma80MtXqWPeS3K3/QQkVKr/FWr1/4oBAAAAAAAAaEtdAACABzCWpqc1l4an1Zea0QIAAAAAAAAAS7NVDlibLd4DzzLAtT8AAAAAAACArfvutPbuG77CAAAAAAAAPu0I3sfFo7DP7QUAAAAASUVORK5CYII="},97:function(t,e,n){"use strict";var i=n(4),o=n(62),r=n(98),s=o.Behavior.extend({onRender:function(){this.setupRegions()},onBeforeShow:function(){this.setupRegions()},setupRegions:function(){if(!this.setup){this.setup=1;var t=this.view,e=this.options;Object.keys(e).forEach(function(n){function o(t,e){var o=a.$el[0];if(!o)throw new Error("Region "+n+" does not exist.");var r,s=o.children.length;if(0===s)r={};else{if(1!==s)throw new Error("Region can have zero or one elements, but not more. Region "+n+" has "+s+". Are you sure you wrapped the region with a parent?");r=e&&e.rerender?{el:o.children[0]}:{template:!1,el:o.children[0]}}return t?i.extend(r,t):r}var r=e[n],s=r.el,a=t.addRegion(n,s),l=r.init;if(l){"string"==typeof l&&(l=t[l]);var c=l.call(t,o,a);c&&t.showChildView(n,c)}})}}});r.register("Isomorphic",s),t.exports=s},98:function(t,e,n){"use strict";var i=n(62);t.exports=function(){var t={};return i.Behaviors.behaviorsLookup=function(){return t},{register:function(e,n){t[e]=n}}}()},109:function(t,e,n){"use strict";function i(t){try{window.parent.location.href=t}catch(e){window.location.href=t}}function o(){return a.all([r.web.post("/logout"),s.uninstall()]).spread(function(t){i(t&&t.redirect?t.redirect:"/")})["catch"](function(){i("/")})}var r=n(110),s=n(113),a=n(8);t.exports=o},113:function(t,e,n){"use strict";function i(){return!!r()&&(!!navigator.serviceWorker.controller&&o.resolve(navigator.serviceWorker.ready).then(function(t){return!!t&&t.pushManager.getSubscription()}).then(function(t){return!!t&&t.unsubscribe()}))}var o=n(8),r=n(114);t.exports={uninstall:o.method(i)}},114:function(t,e){"use strict";function n(){if(!window.Uint8Array)return!1;if(!("serviceWorker"in navigator))return!1;var t=window.ServiceWorkerRegistration;return!!t&&"pushManager"in t.prototype}t.exports=n},115:function(t,e){"use strict";var n;t.exports=function(){return"undefined"==typeof n&&(n=document.body.classList.contains("mobile")),n}},121:function(t,e,n){"use strict";function i(){if(window.parent===window)return!1;try{return window.location.host===window.parent.location.host}catch(t){return!1}}function o(t){try{var e=JSON.stringify(t);s("post: %j to origin %s",e,r.basePath),window.parent.postMessage(e,r.basePath)}catch(n){s("Unable to post message: %j",n)}}var r=n(47),s=n(48)("app:frame-utils");i()&&o({type:"childframe:loaded"}),t.exports={hasParentFrameSameOrigin:i,postMessage:o}},144:function(t,e,n){"use strict";function i(t){return{src:d+"?s="+t,size:t,srcset:d+"?s="+2*t+" 2x"}}function o(t){return t.indexOf("google")!==-1?"sz":"s"}function r(t,e){var n,i=t.pathname;n=e<=24?"_mini":e<=48?"_normal":e<=73?"_bigger":"",t.pathname=t.pathname.replace("_normal",n);var o=t.toString();return t.pathname=i,o}function s(t,e){return{src:r(t,e.srcSize),size:e.size,srcset:r(t,2*e.size)+" 2x"}}function a(t,e){return{src:t.toString(),size:e.size,srcset:t+" 2x"}}function l(t,e){var n=o(t.hostname);t.query[n]=e.srcSize;var i=t.toString();t.query[n]=2*e.size;var r=t.toString()+" 2x";return{src:i,size:e.size,srcset:r}}function c(t,e){var n=f(t.gravatarImageUrl,!0);if(!n)return i(e);n.hostname.indexOf("github")!==-1&&t.username&&n.set("hostname","avatars"+h(t.username)+".githubusercontent.com");var o={size:e,srcSize:e};return"undefined"!=typeof window&&(o.srcSize=e*(window.devicePixelRatio||1)),"pbs.twimg.com"===n.hostname?s(n,o):"media.licdn.com"===n.hostname?a(n,o):l(n,o)}function u(t,e,n){return t.indexOf("_")===-1?"https://avatars"+h(t)+".githubusercontent.com/"+t+"?"+(e?"v="+e:"")+"&s="+n:"/api/private/user-avatar/"+t+"?s="+n}var h=n(145),d="https://avatars1.githubusercontent.com/u/0",f=n(65);t.exports=function(t,e){if(e=e||60,t){if(t.avatarUrlSmall)return{src:t.avatarUrlSmall.replace("=60","="+e),size:e,srcset:t.avatarUrlSmall.replace("=60","="+2*e)+" 2x"};if(t.gravatarImageUrl)return c(t,e);if(t.username){var n=t.gravatarVersion||t.gv;return{src:u(t.username,n,e),size:e,srcset:u(t.username,n,2*e)+" 2x"}}}return i(e)}},145:function(t,e){"use strict";t.exports=function(t){if(!t||!t.length)return 1;for(var e=5381,n=0;n<t.length&&n<8;n++)e=(e<<5)+e+t.charCodeAt(n);return(e>0?e:-e)%3}},146:function(t,e,n){"use strict";var i=n(4),o=n(3),r=n(2),s=n(147),a=n(184),l=n(185),c=n(187),u=n(119),h=n(188).LiveCollection,d=n(228),f=n(239),m=n(241),p=o.Model.extend({idAttribute:"id",initialize:function(){this.listenTo(this,"sync",this.triggerSynced),this.listenTo(this,"request",this.triggerSyncing),this.listenTo(this,"error",this.triggerSyncError),this.listenTo(this,"remove",function(){this.stopListening(this)})},triggerSynced:function(){this._syncErrorTime=null,this.trigger("syncStatusChange","synced")},triggerSyncing:function(){this.trigger("syncStatusChange","syncing")},triggerSyncError:function(){this._syncErrorTime=s(),this.trigger("syncStatusChange","syncerror")},parse:function(t){return t.sent&&(t.sent=s(t.sent,s.defaultFormat)),t.editedAt&&(t.editedAt=s(t.editedAt,s.defaultFormat)),t.unread&&t.fromUser&&t.fromUser.id===r.getUserId()&&(t.unread=!1),t},toJSON:function(){var t=i.clone(this.attributes),e=this.get("sent");return e?t.sent=e.format():delete t.sent,delete t.burstStart,delete t.burstFinal,delete t.fromUser,delete t.html,t},hasSyncError:function(){return!!this._syncErrorTime},sync:f.sync}),g=h.extend({model:p,modelName:"chat",client:function(){return d.getClient()},urlTemplate:"/v1/rooms/:troupeId/chatMessages",contextModel:r.contextModel(),comparator:function(t,e){var n=t.get("sent")||t._syncErrorTime,i=e.get("sent")||e._syncErrorTime;return n?i?n.valueOf()-i.valueOf():-1:i?1:0},initialize:function(){this.listenTo(this,"add",function(t,e){e.once("sort",function(){a.calc.call(this,t)})}),this.listenTo(this,"remove",function(){a.parse(this)}),this.listenTo(this,"sync",function(t){t instanceof o.Model&&this.checkClientClockSkew(t)}),this.listenTo(this,"change:sent",function(t){this.checkClientClockSkew(t)}),this.listenTo(this,"reset sync",function(){a.parse(this)}),this.listenTo(r.troupe(),"change:id",function(){this.setAtTop(!1)})},transformModel:function(t){if(t.unread){var e=t.id,n=this.get(e);n&&n.unread===!1&&delete t.unread}return t},getQuery:function(){return{lookups:["user"]}},getSnapshotExtras:function(){return{lookups:["user"]}},parse:function(t){if(t.lookups){var e=m.parseChats(t);return a.parse(e)}return a.parse(t)},findModelForOptimisticMerge:function(t){var e=this.find(function(e){return!e.id&&e.get("text")===t.get("text")});return e},checkClientClockSkew:function(t){var e=t.attributes.sent,n=t.previousAttributes().sent;if(e&&n){var i=e.valueOf()-n.valueOf();i>2e4&&u.warn("Clock skew is "+i+"ms")}},sync:f.sync});c.mixin(g,l);var v=o.Model.extend({idAttribute:"id"}),_=h.extend({model:v,modelName:"chatReadBy",client:function(){return d.getClient()},urlTemplate:"/v1/rooms/:troupeId/chatMessages/:chatId/readBy",contextModel:function(){return new o.Model({troupeId:r.getTroupeId(),chatId:this.chatMessageId})},initialize:function(t,e){var n=e.userCollection;n&&(this.transformModel=function(t){var e=n.get(t.id);return e?e.toJSON():t}),this.chatMessageId=e.chatMessageId},sync:f.sync});t.exports={ReadByModel:v,ReadByCollection:_,ChatModel:p,ChatCollection:g}},184:function(t,e,n){"use strict";var i=n(4),o=n(3);t.exports=function(){function t(t){return i.isArray(t)?new o.Collection(t):t}function e(t){var e=null;if(0===t)return t;for(;t--&&(e=this.at(t),!e.get("burstStart")););return t}function n(t){if(t===this.length-1)return t;for(var e=null;t<this.length&&(e=this.at(t),!e.get("burstStart"));)t++;return t}function r(t){if(!("burstStart"in t.attributes)){var i=this.indexOf(t),o=e.call(this,i),r=n.call(this,i);a(this,o,r)}}function s(t,e){var n=t.get("fromUser"),i=t.get("sent"),o=n&&n.username,r=i&&new Date(i).valueOf()||Date.now();if(t.get("status"))return e.burstStart=!0,e.prevFinal=!0,void(e.time=r);if(!e.user)return e.burstStart=!0,e.prevFinal=!0,e.user=o,void(e.time=r);var s=r-e.time>l;return e.prevIsStatus||o!==e.user||s?(e.burstStart=!0,e.prevFinal=!0,e.user=o,void(e.time=r)):(e.burstStart=!1,e.prevFinal=!1,void(e.user=o))}function a(e,n,i){var o=t(e);if(o){n="undefined"!=typeof n?n:0,i="undefined"!=typeof i?i:o.length-1;var r={user:null,burstStart:!1,prevFinal:!1,prevIsStatus:!1,time:null};return o.slice(n,i+1).forEach(function(t,e){e+=n,e>0&&(r.prevIsStatus=o.at(e-1).get("status")),s(t,r),t.set("burstStart",r.burstStart),e>0&&o.at(e-1).set("burstFinal",r.prevFinal)}),o.toJSON()}}var l=3e5;return{calc:r,parse:a}}()},185:function(t,e,n){"use strict";var i=n(4),o=n(186),r=n(2),s=n(52),a=n(48)("app:infinite-mixin");t.exports=function(){return{initialize:function(){this.atTop=!1,this.atBottom=!0,this._currentFetchCount=0},getLoadLimit:function(){return Math.round((window.screen.height-150)/20)},getCollectionLimit:function(){return 5*this.getLoadLimit()},ignoreDataChange:function(t){return"create"===t.operation&&!this.atBottom},fetchLatest:function(t,e,n){var r=this;if(!(this.atBottom||this._currentFetchCount>0)){var s=this.getLoadLimit(),l=this.getQuery&&this.getQuery()||{};l=i.defaults(l,{limit:s});var c=o.index(this.pluck("id"),o.identityTransform);a("Fetch latest: options=%j data=%j",t,l),this.trigger("fetch:latest"),this._currentFetchCount+=1,this.fetch({remove:"remove"in t&&t.remove,add:!("add"in t)||t.add,merge:!("merge"in t)||t.merge,data:l,success:function(t,i){r.trigger("fetch:latest:complete"),r.setAtBottom(!0);var a=(i&&i.items||i||[]).map(o.idTransform),l=a.some(function(t){return c[t]});if(!l){var u=Object.keys(c).map(function(t){return r.get(t)});r.remove(u)}i.length<s?r.setAtTop(!0):r.trimTop(),e&&e.call(n),r._currentFetchCount-=1},error:function(t){r.trigger("fetch:latest:complete"),e&&e.call(n||null,t),r._currentFetchCount-=1}})}},fetchMoreBefore:function(t,e,n){if(!(this.atTop||this._currentFetchCount>0)){var r;this.length&&(r=o.min(this.pluck("id")));var s=this.getLoadLimit(),l=this.getQuery&&this.getQuery()||{};l=i.defaults(l,{beforeId:r,limit:s});var c=this;a("Fetch before: options=%j data=%j",t,l),this.trigger("fetch:before"),this._currentFetchCount+=1,this.fetch({remove:"remove"in t&&t.remove,add:!("add"in t)||t.add,merge:!("merge"in t)||t.merge,data:l,success:function(t,i){c.trigger("fetch:before:complete"),i.length<s&&c.setAtTop(!0),c.trimBottom(),e&&e.call(n),c._currentFetchCount-=1},error:function(t){c.trigger("fetch:before:complete"),e&&e.call(t),c._currentFetchCount-=1}})}},fetchMoreAfter:function(t,e,n){var r=this;if(!(this.atBottom||this._currentFetchCount>0)){var s;this.length&&(s=o.max(this.pluck("id")));var l=this.getLoadLimit(),c=this.getQuery&&this.getQuery()||{};c=i.defaults(c,{afterId:s,limit:l}),a("Fetch after: options=%j data=%j",t,c),this.trigger("fetch:after"),this._currentFetchCount+=1,this.fetch({remove:"remove"in t&&t.remove,add:!("add"in t)||t.add,merge:!("merge"in t)||t.merge,data:c,success:function(t,i){r.trigger("fetch:after:complete"),i.length<l&&r.setAtBottom(!0),r.trimTop(),e&&e.call(n),r._currentFetchCount-=1},error:function(t){r.trigger("fetch:after:completed"),e&&e.call(t),r._currentFetchCount-=1}})}},fetchAtPoint:function(t,e,n,r){if(e||(e={}),!(this._currentFetchCount>1)){var s=this.getLoadLimit(),l=o.index(this.pluck("id"),o.identityTransform),c=this.getQuery&&this.getQuery()||{};c=i.defaults(c,t,{limit:s});var u=this;a("Fetch around: options=%j data=%j",e,c),this.trigger("fetch:at"),this._currentFetchCount+=1,this.fetch({remove:"remove"in e&&e.remove,add:!("add"in e)||e.add,merge:!("merge"in e)||e.merge,data:c,success:function(t,e){u.trigger("fetch:at:complete");var i=(e&&e.items||e||[]).map(o.idTransform),s=i.some(function(t){return l[t]});if(!s){u.setAtBottom(!1),u.setAtTop(!1);var a=Object.keys(l).map(function(t){return u.get(t)});u.remove(a)}u.trimBottom(),n&&n.call(r),u._currentFetchCount-=1},error:function(t){u.trigger("fetch:at:complete"),n&&n.call(t),u._currentFetchCount-=1}})}},fetchFromMarker:function(t,e,n,i){return this.fetchAtPoint({marker:t},e,n,i)},ensureLoaded:function(t,e,n){function i(t,i){e&&e.call(n,t,i)}var o=this.get(t);return o?i(null,o):void this.fetchAtPoint({aroundId:t},{},function(e){return e?i(e):i(null,this.get(t))},this)},trimTop:function(){var t=this.getCollectionLimit();if(this.length>t){var e=this.slice(0,-t);this.remove(e),this.setAtTop(!1)}},trimBottom:function(){var t=this.getCollectionLimit();if(this.length>t){var e=this.slice(t);this.remove(e),this.setAtBottom(!1)}},getSnapshotState:function(){var t;this.getSnapshotExtras&&(t=this.getSnapshotExtras());var e=r().snapshots;if(e){var n=e[this.modelName];if(n&&this.contextModel.get("troupeId")===r.getTroupeId()){this.setAtTop(!1),this.setAtBottom(!n.aroundId),this.listenToOnce(this,"snapshot",function(){delete e[this.modelName]});var o=i.extend(n,t);return o}}if(!this.length)return t;if(this.atBottom)return i.extend({limit:this.length},t);var s=this.at(this.length-1).get("id");return i.extend({limit:this.length,beforeInclId:s},t)},setAtTop:function(t){!!t!=!!this.atTop&&(this.atTop=!!t,this.trigger("atTopChanged",this.atTop))},setAtBottom:function(t){!!t!=!!this.atBottom&&(this.atBottom=!!t,this.trigger("atBottomChanged",this.atBottom),s.trigger("atBottomChanged",this.atBottom))}}}()},186:function(t,e){"use strict";t.exports=function(){function t(t,e){return t===e?0:t>e?1:-1}function e(t){return t&&t.id}function n(t){return t}return{naturalComparator:t,identityTransform:n,idTransform:e,index:function(t,n){n||(n=e);for(var i={},o=0;o<t.length;o++){var r=t[o],s=n(r);i[s]?i[s].push(r):i[s]=[r]}return i},extractDateFromDateTime:function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null},extractTimeFromDateTime:function(t){if(!t)return null;var e=t.getHours()+":"+t.getMinutes();return e},formatDate:function(t){return t?t.toLocaleDateString():""},max:function(e,n){n||(n=t);for(var i=e[0],o=1;o<e.length;o++){var r=e[o];n(r,i)>0&&(i=r)}return i},min:function(e,n){n||(n=t);for(var i=e[0],o=1;o<e.length;o++){var r=e[o];n(i,r)>0&&(i=r)}return i}}}()},187:function(t,e,n){var i,o,r;!function(s){"undefined"!=typeof t&&t.exports?t.exports=s(n(4)):(o=[n(4)],i=s,r="function"==typeof i?i.apply(e,o):i,!(void 0!==r&&(t.exports=r)))}(function(t){var e={};e.mixins={},e.mixin=function(n){var i=t.chain(arguments).toArray().slice(1).flatten().value(),o=n.prototype||n,r={};return t.each(i,function(n){t.isString(n)&&(n=e.mixins[n]),t.each(n,function(e,n){if(t.isFunction(e)){if(o[n]===e)return;o[n]&&(r[n]=r.hasOwnProperty(n)?r[n]:[o[n]],r[n].push(e)),o[n]=e}else t.isArray(e)?o[n]=t.union(e,o[n]||[]):t.isObject(e)?o[n]=t.extend({},e,o[n]||{}):n in o||(o[n]=e)})}),t.each(r,function(e,n){o[n]=function(){var n,i=this,o=arguments;return t.each(e,function(e){var r=t.isFunction(e)?e.apply(i,o):e;n="undefined"==typeof r?n:r}),n}}),n};var n;return e.patch=function(i,o){var r=[i.Model,i.Collection,i.Router,i.View].concat(o||[]);n=i.Model.extend;var s=function(t,i){var o=n.call(this,t,i),r=o.prototype.mixins;return r&&o.prototype.hasOwnProperty("mixins")&&e.mixin(o,r),o};t.each(r,function(n){n.mixin=function(){e.mixin(this,t.toArray(arguments))},n.extend=s})},e.unpatch=function(e){t.each([e.Model,e.Collection,e.Router,e.View],function(t){t.mixin=void 0,t.extend=n})},e})},228:function(t,e,n){"use strict";function i(){return navigator.userAgent.toLowerCase().indexOf("mobile")>=0}function o(t){u.getAccessToken().then(function(e){var n=i(),o=_.getAuthDetails(),r=w.extend({token:e,version:h.version,connType:n?"mobile":"online",client:n?"mobweb":"web"},o);return t(r)})}function r(){if(c)return c;var t=h.websockets||{};return c=new p({fayeUrl:t.fayeUrl,authProvider:o,fayeOptions:t.options,extensions:[k,C],websocketsDisabled:u.hasFeature("disable-websockets")}),c.on("stats",function(t,e,n){d.trigger("stats."+t,e,n)}),c.on("connection:up",function(){d.trigger("realtime-connectivity:up")}),c.on("connection:down",function(){d.trigger("realtime-connectivity:down")}),x&&setInterval(function(){v("Performing ping"),c.testConnection("ping")},y),c.subscribeTemplate({urlTemplate:"/v1/user/:userId",contextModel:u.contextModel(),onMessage:function(t){var e=u.user();switch("patch"===t.operation&&t.model&&t.model.id===e.id&&e.set(t.model),t.notification){case"user_notification":u().desktopNotifications&&d.trigger("user_notification",w.extend(t,{notificationKey:t.chatId}));break;case"activity":d.trigger("activity",t)}}}),c}function s(){return c&&c.getClientId()}function a(t){r().reset(t)}function l(t){r().testConnection(t)}var c,u=n(2),h=n(47),d=n(52),f=n(119),m=n(109),p=n(188).RealtimeClient,g=n(188).wrapExtension,v=n(48)("app:realtime"),_=n(229),w=n(4),b=n(237),y=3e4,x=!0,k={incoming:g(function(t,e){if("/meta/handshake"!==t.channel)return e(t);if(t.successful){var n=t.ext;if(n&&(n.appVersion&&b.reportServerVersion(n.appVersion),n.context)){var i=n.context;i.troupe&&u.setTroupe(i.troupe),i.user&&u.setUser(i.user)}}e(t)})},T=!1,C={incoming:g(function(t,e){t.error&&t.advice&&"none"===t.advice.reconnect&&(T||(T=!0,f.error("Access denied",t),window.alert("Realtime communications with the server have been disconnected."),m())),e(t)})};d.on("eyeballsInvalid",function(t){v("Resetting connection after invalid eyeballs"),a(t)}),d.on("reawaken",function(){v("Recycling connection after reawaken"),a(s())}),document.addEventListener&&document.addEventListener("deviceReady",function(){document.addEventListener("online",function(){v("online"),l("device_ready")},!1)},!1),t.exports={getClientId:s,subscribe:function(t,e,n){return r().subscribe(t,e,n)},testConnection:l,reset:a,getClient:function(){return r()}},window._realtime=t.exports},229:function(t,e,n){"use strict";var i=n(2),o=n(230),r=!1;t.exports={track:function(){r||(r=!0)},getAuthDetails:function(){return r?{troupeId:i.getTroupeId(),eyeballs:o.getEyeballs()?1:0}:{}},getEyeballs:function(){return r&&o.getEyeballs()?1:0}}},230:function(t,e,n){"use strict";function i(){var t=f&&m&&p;t!==g&&(g=t,l("Eyeballs change: %s",t),d.trigger("change",g))}function o(){return g}function r(){v.setInactive(!1)}var s=n(4),a=n(3),l=n(48)("app:eyeballs:detector"),c=n(231),u=n(233),h=n(235),d={};s.extend(d,a.Events);var f=!0,m=!0,p=!0,g=!0,v=new c(function(t){l("Activity signal: %s",t),p=t,i()});new h(function(t){l("Visibility signal: %s",t),f=t,i()}),new u(function(t){l("Focus signal: %s",t),m=t,t?v.setInactive(!1):v.setInactive(!0),i()}),t.exports={getEyeballs:o,forceActivity:r,events:d}},231:function(t,e,n){"use strict";function i(t){this._callback=t,this._inactivityTimer=null,this.inactive=null,this._lastUserInteraction=null;var e=o.debounce(this._registerInteraction.bind(this),500);r.addEventListener(document,"keydown",e),r.addEventListener(document,"mousemove",e),r.addEventListener(document,"touchstart",e),r.addEventListener(window,"scroll",e),this.setInactive(!1)}var o=n(4),r=n(232),s=6e4,a=1e4;i.prototype.setInactive=function(t){this.inactive!==t&&(this.inactive=t,t?this._stopInactivityPoller():(this._lastUserInteraction=Date.now(),this._startInactivityPoller()),this._callback(!t))},i.prototype._registerInteraction=function(){this.setInactive(!1)},i.prototype._startInactivityPoller=function(){var t=this;t._inactivityTimer||(t._inactivityTimer=setInterval(function(){setTimeout(function(){Date.now()-t._lastUserInteraction>s-a&&t.setInactive(!0)},5)},a))},i.prototype._stopInactivityPoller=function(){this._inactivityTimer&&(clearTimeout(this._inactivityTimer),this._inactivityTimer=null)},t.exports=i},232:function(t,e){"use strict";function n(t,e,n){var i;i=!!o&&{passive:!0},t.addEventListener(e,n,i)}function i(t,e,n){var i;i=!!o&&{passive:!0},t.removeEventListener(e,n,i)}var o=!1;try{var r=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("test",null,r)}catch(s){}t.exports={addEventListener:n,removeEventListener:i}},233:function(t,e,n){"use strict";function i(t){function e(t){return function(){a[t]=!0,l()}}function n(t){return function(){a[t]=!1,l()}}function i(t){function i(){r&&(o.removeEventListener(r,"focus",h),o.removeEventListener(r,"blur",d),o.removeEventListener(r,"unload",i),r=null)}var r=t.contentWindow,s=r.document.hasFocus(),c=a.push(s),u=c-1,h=e(u),d=n(u);o.addEventListener(r,"focus",h),o.addEventListener(r,"blur",d),o.addEventListener(r,"unload",i),o.addEventListener(t,"load",function(){if(r!==t.contentWindow){r=t.contentWindow,o.addEventListener(r,"focus",h),o.addEventListener(r,"blur",d),o.addEventListener(r,"unload",i);var e=r.document.hasFocus();a[u]=e,l()}})}var a=[document.hasFocus()],l=r.debounce(function(){var e=a.some(function(t){return t});t(!!e)});o.addEventListener(window,"focus",e(0)),o.addEventListener(window,"blur",n(0)),s(function(){for(var t=document.querySelectorAll("iframe"),e=0;e<t.length;e++){var n=t[e];i(n)}l()})}var o=n(232),r=n(234),s=n(59);t.exports=i},234:function(t,e,n){"use strict";function i(t,e){var n;return function(){n&&s.cancel(n),n=s(function(){n=void 0,t.call(e)})}}function o(t,e){var n;return function(){n||(n=s(function(){n=void 0,t.call(e)}))}}function r(t,e){function n(){t(),Date.now()<i&&s(n)}var i=Date.now()+e;s(n)}var s=n(57);t.exports={debounce:i,throttle:o,intervalUntil:r}},235:function(t,e,n){"use strict";function i(t){r.addEventListener(window,"pageshow",function(){t(!0)}),r.addEventListener(window,"pagehide",function(){t(!1)}),o.events.on("change",function(){t(o.isHidden()?!1:!0)})}var o=n(236),r=n(232);t.exports=i},236:function(t,e,n){"use strict";function i(){if("undefined"!=typeof document.hidden)return{prop:"hidden",eventName:"visibilitychange"};for(var t=0;t<c.length;t++){
var e=c[t];if("undefined"!=typeof document[e+"Hidden"])return{prop:e+"Hidden",eventName:e+"visibilitychange"}}}function o(){l.trigger("change")}function r(){if(h)return document[h]}var s=n(4),a=n(3),l={};s.extend(l,a.Events);var c=["moz","ms","webkit"],u=i(),h=u&&u.prop,d=u&&u.eventName;d&&document.addEventListener(d,o,!1),t.exports={events:l,isHidden:r}},237:function(t,e,n){"use strict";function i(){return Math.round(60*(v+Math.random()*(_-v))*1e3)}function o(){f("The time has come. To say fair's fair. To pay the rent. To pay our share."),m.hasParentFrameSameOrigin()?window.parent.location.reload(!0):window.location.reload(!0)}function r(){this.onlineChangeBound=this.onlineChange.bind(this),this.eyeballsChangeBound=this.eyeballsChange.bind(this),this.listen()}function s(){if(!c&&!u){var t=i();f("Application version mismatch. Will restart after %s ms",t),c=setTimeout(function(){u||(u=new r)},t)}}function a(){c&&(clearTimeout(c),c=null),u&&(u.destroy(),u=null)}function l(t){t===d?a():s()}var c,u,h=n(47),d=h.version,f=n(48)("app:reload-on-update"),m=n(121),p=n(238),g=n(230),v=30,_=60,w=12e4;r.prototype={listen:function(){var t={eyeballsOff:!g.getEyeballs()};Navigator.prototype.hasOwnProperty("onLine")&&(t.online=window.navigator.onLine,window.addEventListener("online",this.onlineChangeBound),window.addEventListener("offline",this.onlineChangeBound)),g.events.on("change",this.eyeballsChangeBound),this.conditionalDebouncer=new p(t,w,o)},onlineChange:function(t){if(this.conditionalDebouncer){var e="online"===t.type;this.conditionalDebouncer.set("online",e)}},eyeballsChange:function(t){this.conditionalDebouncer&&this.conditionalDebouncer.set("eyeballsOff",!t)},destroy:function(){this.conditionalDebouncer.cancel(),this.conditionalDebouncer=null,Navigator.prototype.hasOwnProperty("onLine")&&(window.removeEventListener("online",this.onlineChangeBound),window.removeEventListener("offline",this.onlineChangeBound)),g.events.off("change",this.eyeballsChangeBound)}},t.exports={reportServerVersion:l}},238:function(t,e,n){"use strict";function i(t,e,n){this.conditions=t,this.timeout=e,this.timer=null,this.fn=n,this.checkConditions()}var o=n(48)("app:conditional-debounce");i.prototype.set=function(t,e){this.conditions[t]=e,o("set: %s=%s",t,e),this.checkConditions()},i.prototype.checkConditions=function(){o("check conditions: %j",this.conditions);var t=this.conditions,e=Object.keys(t).every(function(e){return t[e]});e?this.timer||(o("All signals go. Commencing countdown sequence."),this.timer=setTimeout(this.fire.bind(this),this.timeout)):this.timer&&(o("Some signals no go. Cancelling timeout function"),clearTimeout(this.timer),this.timer=null)},i.prototype.fire=function(){this.timer=null,o("Debounced timeout, firing debounced function"),this.fn()},i.prototype.cancel=function(){clearTimeout(this.timer),this.timer=null},t.exports=i},239:function(t,e,n){"use strict";var i=n(110),o=n(240),r=o(i);t.exports=r},240:function(t,e,n){"use strict";function i(t){function e(e,n,i,o){switch(e){case"get":return t.get(n,o.data);case"patch":return o.attrs?t.patch(n,o.attrs):t.patch(n,i);default:return t[e](n,i)}}return{sync:function(t,n,i){var s=i.url||o.result(n,"url");if(!s)throw new Error("URL required");var a=r[t],l=e(a,s,n,i);return i.success&&(l=l.tap(i.success)),i.error&&(l=l["catch"](i.error)),n.trigger("request",n,null,o.extend({},i,{method:t})),l}}}var o=n(4),r={create:"post",update:"put",patch:"patch","delete":"delete",read:"get"};t.exports=i},241:function(t,e,n){"use strict";function i(t,e){var n=Object.keys(t.lookups),i={};return r.each(n,function(e){var n=r.indexBy(t.lookups[e],"id");i[e]=n}),r.each(t.items,function(t){r.each(e,function(e,n){t[n]=i[e][t[n]]})}),t.items}function o(t){return i(t,{fromUser:"users"})}var r=n(4),e=t.exports;e.parseLookups=i,e.parseChats=o},249:function(t,e,n){"use strict";var i=n(4),o=n(2),r=n(228),s=n(110),a=n(48)("app:unread-items-client"),l=n(3),c=n(52),u=n(250),h=n(119),d=n(57),f=n(232),m=n(230);t.exports=function(){function t(t,e,n){return i.throttle(t.bind(e),n||30,{leading:!1})}function e(t,e){var n=o.user();n.id?t.call(e,n.id):n.once("change:id",function(){t.call(e,n.id)})}function n(t,e){e.on("add",function(e){e.id&&e.get("unread")&&t.isMarkedAsRead(e.id)&&(a("item already marked as read"),e.set("unread",!1))}),t.on("unreadItemRemoved",function(t){a("CollectionSync: unreadItemRemoved: %s mention=%s",t),e.patch(t,{unread:!1,mentioned:!1},{fast:!0})}),t.on("itemMarkedRead",function(t,n){a("CollectionSync: itemMarkedRead: %s mention=%s",t,n),e.patch(t,{unread:!1,mentioned:n})}),t.on("change:status",function(t,n){a("CollectionSync: change:status: %s mention=%s",t),e.patch(t,{unread:!0,mentioned:n})}),t.on("add",function(t,n){function i(t,n){if(!n&&e.atBottom&&e.length){var i=e.at(0);t<i.id||(h.warn("An unread item does not exist in the chat collection: id="+t),c.trigger("stats.event","missing.chat.item"))}}a("CollectionSync: add: %s mention=%s",t,n),e.patch(t,{unread:!0,mentioned:n},null,i)}),t.on("reset",function(){a("CollectionSync: reset");var n=t.getItemHash();e.each(function(t){var e=t.id,i=n[e],o={fast:!0};i===!1?t.set({unread:!0,mentioned:!1},o):i===!0?t.set({unread:!0,mentioned:!0},o):t.set({unread:!1,mentioned:!1},o)})})}function p(){if(k)return k;if(o.troupe().id){k=new u,k.on("newcountvalue",function(t){c.trigger("unreadItemsCount",t)}),new b(k);var t=new y(k);return t._subscribe(),k}return null}function g(){var t=p();if(t)return t;throw new Error("Unable to create an unread items store without a user")}var v=function(){this._items={},this._timer=setInterval(this._gc.bind(this),6e4)};v.prototype={add:function(t){this._items[t]=Date.now()},remove:function(t){delete this._items[t]},contains:function(t){return!!this._items[t]},_gc:function(){var t=Date.now()-3e5,e=this._items;Object.keys(e).forEach(function(n){e[n]<t&&delete e[n]})}};var _=1e3,w=function(e,n){this._store=e,this._chatCollection=n,this._eyeballState=!0,this._timers={},this._lastSeenItems={},e.on("reset",this._onStoreReset,this),e.on("itemMarkedRead",this._onItemMarkedRead,this),n.on("reset",this._onCollectionReset,this),this._clearActivityBadgeLimited=t(this._clearActivityBadge,this,100)};w.prototype={_activity:function(t){this._clearActivityBadgeLimited();var e=o.getTroupeId();(t||(t=this._findMostRecentId()))&&(this._lastSeenItems[e]>=t||(this._lastSeenItems[e]=t,this._timers[e]||(this._timers[e]=setTimeout(function(){a("_updateLastAccess: %s",e);var t=this._lastSeenItems[e];delete this._timers[e],s.user.put("/rooms/"+e+"/unreadItems/"+t,"",{dataType:"text"}).then(function(){a("_updateLastAccess done")})}.bind(this),_))))},_findMostRecentId:function(){return this._chatCollection.reduce(function(t,e){return t&&t>e.id?t:e.id},null)},_clearActivityBadge:function(){c.trigger("clearActivityBadge")},_onItemMarkedRead:function(t,e,n){n&&this._activity(t)},_onStoreReset:function(){var t=this._store.getLurkMode();t&&m.getEyeballs()&&this._activity()},_onCollectionReset:function(){this._onStoreReset()}};var b=function(e){this._buffer={},this._sendLimited=t(this._send,this,1e3),e.on("itemMarkedRead",this._onItemMarkedRead.bind(this));var n=this._onWindowUnload.bind(this);["unload","beforeunload"].forEach(function(t){window.addEventListener(t,n,!1)})};b.prototype={_onItemMarkedRead:function(t,e,n){if(!n||e){var i=o.getTroupeId(),r=this._buffer[i];r||(r=this._buffer[i]={}),r[t]=!0,this._sendLimited()}},_onWindowUnload:function(){Object.keys(this._buffer)>0&&this._send({sync:!0})},_send:function(t){a("_send"),Object.keys(this._buffer).forEach(function(e){this._sendForRoom(e,t)},this)},_sendForRoom:function(t,n){function i(){s.user.post("/rooms/"+t+"/unreadItems",r,{async:l,global:!1})["catch"](function(){a("Error posting unread items to server. Will attempt again in 5s"),++c<10&&setTimeout(i,5e3)})}a("_sendForRoom: %s",t);var o=Object.keys(this._buffer[t]);if(delete this._buffer[t],o.length){var r={chat:o},l=!n||!n.sync,c=0;e(i)}}};var y=function(t){this._store=t};i.extend(y.prototype,l.Events,{_subscribe:function(){var t=this._store,e=r.getClient().subscribeTemplate({urlTemplate:"/v1/user/:userId/rooms/:troupeId/unreadItems",contextModel:o.contextModel(),onMessage:function(e){switch(a("Realtime: Channel message: %j",e),e.notification){case"unread_items":t.add(e.items);break;case"unread_items_removed":t.remove(e.items);break;case"mark_all_read":t.markAllReadNotification();break;case"lurk_change":e.lurk?t.enableLurkMode():t.disableLurkMode()}},handleSnapshot:function(e){a("Realtime: Channel snapshot: %j",e);var n=o.troupe().get("roomMember"),i=e._meta&&e._meta.lurk,r=i||!n;t.reset(e,r)}});e.on("resubscribe",function(){a("Realtime: resubscribe"),t.state="LOADING",t.reset()})}});var x=function(e,n,r){function s(){d(l)}var l=this._getBounds.bind(this),c=t(this._getBounds,this,100),u=i.debounce(this._getBounds.bind(this),100);this._collectionView=r,this._scrollElement=e[0]||e,this._store=n,this._windowScrollLimited=t(this._windowScroll,this,50);var h=this._foldCountLimited=t(this._foldCount,this,50);m.events.on("change",this._eyeballStateChange,this),f.addEventListener(this._scrollElement,"scroll",s),n.on("newcountvalue",h),["unreadItemRemoved","change:status","itemMarkedRead","add"].forEach(function(t){n.on(t,c)}),r.collection.on("add",u),setInterval(c,2e3);var p=this;r.listenTo(o.troupe(),"change:lastAccessTime",function(t){if(o.troupe().get("lurk")){var e=t.get("lastAccessTime");this.collection.forEach(function(t){return t.get("sent")?void(t.get("sent").isBefore(e)&&t.get("unread")&&p._store.markItemRead(t.id)):void a("Chat is missing sent %j",t)})}})};x.prototype={_viewReady:function(){var t=this._collectionView,e=t.collection,n=e.models.length===t.children.length;return n||a("Mismatch: collection.length=%s, collectionView.length=%s",e.models.length,t.children.length),n},_getBounds:function(){return m.getEyeballs()?(this._scrollBounds(),void this._windowScrollLimited()):void this._foldCountLimited()},_scrollBounds:function(){var t=this._scrollElement.scrollTop,e=t+this._scrollElement.clientHeight;(!this._scrollTop||t<this._scrollTop)&&(this._scrollTop=t),(!this._scrollBottom||e>this._scrollBottom)&&(this._scrollBottom=e)},_windowScroll:function(){if(m.getEyeballs()){if(!this._viewReady())return a("Skipping windowScroll until view is ready...."),void this._windowScrollLimited();this._scrollBounds();var t=this,e=this._scrollTop,n=this._scrollBottom;delete this._scrollTop,delete this._scrollBottom;var i=this.findModelsInViewport(e,n);i.forEach(function(e){e.get("unread")&&t._store.markItemRead(e.id)}),this._foldCount()}},findModelsInViewport:function(t,e){var n,o=this._collectionView,r=o.collection;r.models.length===o.children.length?n=r.models:(a("Mismatch between childCollection.models.length (%s) and cv.children.length (%s) resorting to oddness",r.models.length,o.children.length),n=r.models.filter(function(t){return o.children.findByModelCid(t.cid)}));var s=i.sortedIndex(n,t,function(t){if("number"==typeof t)return t;var e=o.children.findByModelCid(t.cid);return e.el.offsetTop}),l=n.slice(s);if(e===Number.POSITIVE_INFINITY)return l;var c=i.sortedIndex(l,e,function(t){if("number"==typeof t)return t;var e=o.children.findByModelCid(t.cid);return e.el.offsetTop});return l.slice(0,c)},_resetFoldModel:function(){T.set({unreadAbove:0,unreadBelow:0,hasUnreadBelow:!1,hasUnreadAbove:!1,oldestUnreadItemId:null,mostRecentUnreadItemId:null,mentionsAbove:0,mentionsBelow:0,hasMentionsAbove:!1,hasMentionsBelow:!1,oldestMentionId:null,mostRecentMentionId:null})},_foldCount:function(){if(!this._viewReady())return a("Skipping fold count until view is ready"),void this._foldCountLimited();var t=this._store,e=t.getItems();if(!e.length)return void this._resetFoldModel();var n=0,i=0,o=0,r=0,s=this._scrollElement,l=s.scrollTop,c=l+s.clientHeight;c>=s.scrollHeight-10&&(c=Number.POSITIVE_INFINITY);var u=this.findModelsInViewport(l,c);if(!u.length)return void this._resetFoldModel();var h=u[0],d=u[u.length-1],f=h.id,m=d.id,p=null,g=null,v=null,_=null;e.forEach(function(e){e<f&&(n++,p||(p=e),t._items[e]&&(o++,v=e)),e>m&&(i++,g||(g=e),t._items[e]&&(r++,_||(_=e)))}),T.set({unreadAbove:n,unreadBelow:i,hasUnreadAbove:n>0,hasUnreadBelow:i>0,oldestUnreadItemId:p,mostRecentUnreadItemId:g,mentionsAbove:o,mentionsBelow:r,hasMentionsAbove:o>0,hasMentionsBelow:r>0,oldestMentionId:v,mostRecentMentionId:_})},_eyeballStateChange:function(t){t&&this._getBounds()}};var k,T=new l.Model({defaults:{unreadAbove:0,unreadBelow:0,hasUnreadBelow:!1,hasUnreadAbove:!1,belowItemId:null}}),C={acrossTheFold:function(){return T},markAllRead:function(){var t=g();e(function(){s.userRoom["delete"]("/unreadItems/all").then(function(){t.markAllRead()})})},syncCollections:function(t){var e=g();new n(e,t.chat)},monitorViewForUnreadItems:function(t,e){var n=g();return new w(k,e.collection),new x(t,n,e)}};return C.getStore=function(){return k},C.UnreadItemStore=u,window._unreadItems=C,C}()},250:function(t,e,n){"use strict";function i(t,e,n){return r.throttle(t.bind(e),n||30,{leading:!1})}function o(t,e,n){var i=t.chat,o=t.mention,r={};i&&i.forEach(function(t){r[t]=!1}),o&&o.forEach(function(t){r[t]=!0}),Object.keys(r).forEach(function(t){var i=r[t];e.call(n,t,i)})}var r=n(4),s=n(3),a=function(){this._items={},this._timer=setInterval(this._gc.bind(this),6e4)};a.prototype={add:function(t){this._items[t]=Date.now()},remove:function(t){delete this._items[t]},contains:function(t){return!!this._items[t]},reset:function(){this._items={}},_gc:function(){var t=Date.now()-3e5,e=this._items;Object.keys(e).forEach(function(n){e[n]<t&&delete e[n]})}};var l=function(){this.length=0,this._lurkMode=!1,this._items={},this._read=new a,this.state="LOADING",this.notifyCountLimited=i(this.notifyCount,this,30)};r.extend(l.prototype,s.Events,{_unreadItemAdded:function(t,e,n){var i=n&&n.silent,o=this._lurkMode;return this._read.contains(t)?(i||this.trigger("itemMarkedRead",t,e,o),!1):this._items.hasOwnProperty(t)?this._items[t]!==e&&(this._items[t]=e,i||this.trigger("change:status",t,e),!0):(this._items[t]=e,this.length++,i||(this.notifyCountLimited(),this.trigger("add",t,e)),!0)},_unreadItemRemoved:function(t){this._items.hasOwnProperty(t)&&(delete this._items[t],this.length--,this.notifyCountLimited(),this.trigger("unreadItemRemoved",t))},_mentionRemoved:function(t){this._items.hasOwnProperty(t)&&(this._items[t]=!1,this.notifyCountLimited(),this.trigger("change:status",t,!1))},markItemRead:function(t){var e,n=this._items.hasOwnProperty(t),i=this._lurkMode;n?(e=this._items[t],delete this._items[t],this.length--,this.notifyCountLimited()):e=!1,this._read.add(t),this.trigger("itemMarkedRead",t,e,i)},add:function(t){o(t,function(t,e){this._unreadItemAdded(t,e)},this)},remove:function(t){function e(t){return t?t.reduce(function(t,e){return t[e]=!0,t},{}):{}}var n=e(t.chat),i=e(t.mention),o=r.extend({},n,i),s=this;Object.keys(o).forEach(function(t){var e=n[t];e?s._unreadItemRemoved(t):s._mentionRemoved(t)})},notifyCount:function(){this.trigger("newcountvalue",this.length)},getItems:function(){return Object.keys(this._items)},getItemHash:function(){return this._items},getMentions:function(){return Object.keys(this._items).reduce(function(t,e){return this._items[e]&&t.push(e),t}.bind(this),[])},getLurkMode:function(){return this._lurkMode},enableLurkMode:function(){this._lurkMode=!0,this.markAllReadNotification()},disableLurkMode:function(){this._lurkMode=!1},markAllRead:function(){var t=this._lurkMode;Object.keys(this._items).forEach(function(e){var n=this._items[e];this._read.add(e),this.trigger("itemMarkedRead",e,n,t)},this),this._items={},this.length=0,this.notifyCountLimited()},markAllReadNotification:function(){Object.keys(this._items).forEach(function(t){this.trigger("unreadItemRemoved",t)},this),this._items={},this.length=0,this.notifyCountLimited()},getFirstItem:function(){return Object.keys(this._items).reduce(function(t,e){return null===t?e:t<e?t:e},null)},isMarkedAsRead:function(t){return this._read.contains(t)},reset:function(t,e){this.length=0,this._lurkMode=!!e,this._read.reset(),this._items={},t?(this.state="LOADED",o(t,function(t,e){this._unreadItemAdded(t,e,{silent:!0})},this),this.trigger("reset"),this.notifyCountLimited()):"LOADED"===this.state&&this.notifyCountLimited()}}),t.exports=l},254:function(t,e,n){"use strict";var i=n(62),o=n(255),r=n(52),s=n(256),a=n(303),l=n(2),c=n(249);n(97),t.exports=i.LayoutView.extend({behaviors:{Isomorphic:{chat:{el:"#chat-container",init:function(t){var e=this.chatCollectionView=new s(t({collection:this.collection,decorators:this.options.decorators}));return this.options.monitorScrollPane&&c.monitorViewForUnreadItems(this.options.monitorScrollPane,e),e}},connectivityIndicator:{el:".chat-connectivity-indicator-wrapper",init:"initConnectivityIndicatorView"}}},initConnectivityIndicatorView:function(t){if(l.hasFeature("connectivity-indicator"))return new a(t({}))},ui:{primaryScroll:".primary-scroll"},events:{click:"onClick"},onRender:function(){o()&&this.ui.primaryScroll.addClass("scroller")},onClick:function(t){var e=window.getSelection().toString().length>0;e||"textarea"===t.target.tagName.toLowerCase()||r.trigger("focus.request.chat")}})},255:function(t,e){"use strict";function n(){var t=document.createElement("div");t.className="scrollbar-measure",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e>0}var i;t.exports=function(){return void 0!==i?i:i=n()}},256:function(t,e,n){"use strict";var i=n(6),o=n(62),r=n(52),s=n(257),a=n(295),l=n(296),c=n(2),u=n(299),h=n(48)("app:chat-collection-view"),d=n(283);n(300),n(302),t.exports=function(){function t(t){var e=t.previousSibling;return!e||3===e.nodeType&&!e.previousSibling&&e.textContent.match(/^[\s\n\r]*$/)}function e(t){var e=t.nextSibling;return!e||3===e.nodeType&&!e.nextSibling&&e.textContent.match(/^[\s\n\r]*$/)}function n(e,n){for(;t(n)&&n!==e;)n=n.parentElement;return n===e}function f(t,n){for(;e(n)&&n!==t;)n=n.parentElement;return n===t}function m(t,e){var n=t.filter(function(t){var n=t.get("fromUser");return n&&n.id===e});return n[n.length-1]}function p(t,e,n){for(var i,o=[],r=0,s=t.children;r<s.length&&(i=s.findByIndex(r),i.el!==e);)r++;for(;r<s.length;){if(i=s.findByIndex(r),o.push(i.model),i.el===n)return o;r++}return[]}function g(t){var e=t.map(function(e){var n;if(t.length>1&&e.get("burstStart")){var i=e.get("fromUser"),o=i&&i.username;o&&(o="@"+o),n=o+"\n"+e.get("text")}else n=e.get("text");return n?("\n"!==n.charAt(n.length-1)&&(n+="\n"),n):""}).join("");return"\n"===e.charAt(e.length-1)?e.substring(0,e.length-1):e}var v="#content-frame",_=o.CollectionView.extend({template:!1,reorderOnSort:!0,behaviors:{InfiniteScroll:{reverseScrolling:!0,scrollElementSelector:v,contentWrapperSelector:"#chat-container"},SmoothScroll:{scrollElementSelector:v,contentWrapper:"#chat-container"}},events:{copy:"onCopy"},childView:s.ChatItemView,childViewOptions:function(t){var e={decorators:this.decorators,rollers:this.rollers};if(t&&t.id){var n=this.$el.find(".model-id-"+t.id)[0];n&&(e.el=n)}return e},initialize:function(t){this.firstRender=!0,this.viewComparator=this.collection.comparator,this.listenTo(r,"chatCollectionView:scrollToBottom",function(){this.collection.fetchLatest({},function(){this.rollers.scrollToBottom(),this.clearHighlight()},this)}),this.listenTo(r,"chatCollectionView:selectedChat",function(t,e){var n=this.collection.get(t);this.clearHighlight(),n&&(this.highlightChat(n,e.highlights),this.highlighted=n,this.scrollToChat(n))}),this.listenTo(r,"chatCollectionView:permalinkHighlight",this.highlightPermalinkChat),this.listenTo(r,"chatCollectionView:clearHighlight",this.clearHighlight),this.listenTo(r,"chatCollectionView:loadAndHighlight",this.loadAndHighlight);var e=document.querySelector(v);this.rollers=new a(e,this.el),this.decorators=t.decorators||[],this.listenTo(r,"chat.send",function(){this.rollers.scrollToBottom(),this.collection.fetchLatest({},function(){},this)}),this.listenTo(this.collection,"fetch:after",function(){h("Switching rollers to stable and locking"),this.rollers.stable(),this.rollers.setModeLocked(!0)}),this.listenTo(this.collection,"fetch:after:complete",function(){h("Unlocking rollers"),this.rollers.setModeLocked(!1)}),this.listenTo(r,"command.collapse.chat",this.collapseChats),this.listenTo(r,"command.collapse.chat.all",this.collapseAllChats),this.listenTo(r,"command.expand.chat",this.expandChats),this.listenTo(r,"chatCollectionView:pageUp",this.pageUp),this.listenTo(r,"chatCollectionView:pageDown",this.pageDown),this.listenTo(r,"chatCollectionView:editLastChat",this.editLastChat),this.listenTo(r,"chatCollectionView:substLastChat",this.substLastChat),this.listenTo(r,"chatCollectionView:viewportResize",this.viewportResize),this.listenTo(r,"chatCollectionView:scrollToChatId",this.scrollToChatId),this.listenTo(c.troupe(),"change:id",function(){this.scrollToBottom()})},onTrackViewportCenter:function(){if(!this.isScrolledToBottom()){var t=this.rollers.getMostCenteredElement();this.rollers.stable(t)}},scrollToBottom:function(){this.rollers.scrollToBottom()},isScrolledToBottom:function(){return this.rollers.isScrolledToBottom()},pageUp:function(){this.scroll.pageUp()},pageDown:function(){this.scroll.pageDown()},scrollToChat:function(t){var e=this.children.findByModel(t);if(e)return this.rollers.scrollToElement(e.el,{centre:!0}),!0},scrollToChatId:function(t){var e=this.collection.get(t);if(e)return this.scrollToChat(e);var n=this;this.collection.ensureLoaded(t,function(){var e=n.collection.get(t);if(e)return this.scrollToChat(e)}.bind(this))},highlightChat:function(t,e){t.set("highlights",e||[])},clearHighlight:function(){var t=this.highlighted;if(t)try{this.highlightChat(t)}catch(e){h("Could not clear previously highlighted item")}},findLastCollapsibleChat:function(){for(var t=this.collection,e=t.length-1;e>=0;e--){var n=t.at(e);if(n.get("isCollapsible"))return n}},setLastCollapsibleChat:function(t){var e=this.findLastCollapsibleChat();if(e){var n=this.children.findByModel(e);n&&n.setCollapse(t)}},collapseChats:function(){this.setLastCollapsibleChat(!0)},collapseAllChats:function(){d.collapseAll(this.collection)},expandChats:function(){this.setLastCollapsibleChat(!1)},onCopy:function(t){if(window.getSelection){t.originalEvent&&(t=t.originalEvent);var e=window.getSelection();if(e&&e.rangeCount&&e.getRangeAt){var o=e.getRangeAt(0),r=""+e,s=i(o.startContainer).parents(".chat-item")[0],a=i(o.endContainer).parents(".chat-item")[0];if(s&&a){var l=i(o.startContainer).parents(".js-chat-item-text")[0],c=i(o.endContainer).parents(".js-chat-item-text")[0];if(l&&c&&l===c){if(o.startOffset>0||o.endOffset<o.endContainer.textContent.length)return;var u=n(l,o.startContainer),h=f(l,o.endContainer);if(!u||!h)return}var d=p(this,s,a);if(o.startContainer.textContent.length&&o.startContainer.textContent.length===o.startOffset&&d.shift(),0===o.endOffset&&d.pop(),d.length){var m=g(d);t.clipboardData.setData("text/plain",r),t.clipboardData.setData("text/x-markdown",m),t.preventDefault()}}}}},editLastChat:function(t){var e=m(this.collection,t);if(e){var n=this.children.findByModel(e);n&&n.toggleEdit()}},substLastChat:function(t,e,n,i){var o=m(this.collection,t);if(o){var r=this.children.findByModel(o);r&&r.subst(e,n,i)}},viewportResize:function(t){t?this.rollers.adjustScrollContinuously(500):this.rollers.adjustScroll(500)},highlightPermalinkChat:function(t){var e=this;this.collection.ensureLoaded(t,function(t,n){if(!t&&n){var i=l(e.collection,n);i.forEach(function(t){var n=e.children.findByModel(t);n&&n.highlight()}),e.scrollToChat(i[0])}})},loadAndHighlight:function(t,e){this.collection.ensureLoaded(t,function(t,n){t||n&&(this.clearHighlight(),n&&(this.highlightChat(n,e&&e.highlights),this.highlighted=n,this.scrollToChat(n)))}.bind(this))},onBeforeRender:function(){if(u.start("chat-collection.render"),this._renderStartTime=Date.now(),!this.collection.length&&this.isRendered)for(var t,e=this.el;t=e.firstChild;)e.removeChild(t)},onRender:function(){var t=this.collection.length;if(t){u.end("chat-collection.render"),this.collection.loading||u.end("room-switch.render");var e=c(),n=e.permalinkChatId;n&&(this.highlightPermalinkChat(n),delete e.permalinkChatId)}}});return _}()},257:function(t,e,n){"use strict";var i=n(6),o=n(4),r=n(81),s=n(2),a=n(47),l=n(146),c=n(258),u=n(62),h=n(147),d=n(115),f=n(272),m=n(273),p=n(261),g=n(274),v=n(275),_=n(276),w=n(277),b=n(52),y=n(187),x=n(283),k=n(284),T=n(268),C=n(286),E=n(287),S=n(288),A=n(60),I=n(57),L=n(289);n(290),n(266),n(291),n(293),n(294),n(269),t.exports=function(){var t=function(t){return"model-id-"+t},e=640,n=6e5,M={"click .js-chat-item-edit":"toggleEdit","click .js-chat-item-collapse":"toggleCollapse","click .js-chat-item-readby":"showReadBy","click .js-chat-item-from":"mentionUser","click .js-chat-time":"permalink","mouseover .js-chat-item-readby":"showReadByIntent","click .webhook":"expandActivity",click:"onClick","click .js-chat-item-actions":"showActions"},B={touchstart:"onTouchstart",touchmove:"onTouchmove",touchend:"onTouchend"},R={click:"onTap"},D=u.ItemView.extend({attributes:function(){var e={"chat-item":!0},n=this.model.get("id");return n&&(e[t(n)]=!0),{"class":r(e)}},ui:{actions:".js-chat-item-actions",collapse:".js-chat-item-collapse",text:".js-chat-item-text",sent:".js-chat-time",timestampLink:".js-chat-time"},behaviors:{Widgets:{},UnreadItems:{},Highlight:{},LastMessageSeen:{},TimeAgo:{modelAttribute:"sent",el:".js-chat-time"},Tooltip:{".js-chat-time":{titleFn:"getSentTimeTooltip",html:!0}}},modelEvents:{syncStatusChange:"onSyncStatusChange",change:"onChange"},isEditing:!1,events:function(){return d()?f()?R:B:M},expandActivity:function(){i(".webhook .commits").slideToggle("fast")},initialize:function(t){if(this.rollers=t.rollers,this._oneToOne=s.inOneToOneTroupeContext(),this.isPermalinkable=!this._oneToOne,this.userCollection=t.userCollection,this.decorated=!1,this.doubleTapper=new m,this.isInEditablePeriod()){var e=this.model.get("sent"),i=e?e.valueOf()-Date.now()+n:n;this.timeChangeTimeout=setTimeout(this.timeChange.bind(this),i+50)}this.listenToOnce(this,"messageInViewport",this.decorate)},onDestroy:function(){clearTimeout(this.timeChangeTimeout)},template:function(t){return t.status?v(t):g(t)},serializeData:function(){var t=o.clone(this.model.attributes);return t.model=this.model,t.roomName=s.troupe().get("uri"),t.fromUser&&(t.username=t.fromUser.username,t.displayName=t.fromUser.displayName),t.sent||(t.sent=h()),t.sentTimeFormatted=C(t.sent),t.permalinkUrl=this.getPermalinkUrl(),t.sentTimeFormattedFull=E(t.sent),t.readByText=this.getReadByText(t.readBy),t.html||(t.html=o.escape(t.text)),t.isPermalinkable=this.isPermalinkable,t},getReadByText:function(t){return t?this._oneToOne?" ":(t>10&&(t=10),t):""},onChange:function(){this.updateRender(this.model.changed)},renderText:function(){var t=this.model,e=t.get("html")||o.escape(t.get("text"));0===e.length&&(e="<i>This message was deleted</i>",this.$el.addClass("deleted")),this.ui.text[0].innerHTML=e,this.decorated&&this.decorate()},decorate:function(){this.decorated=!0,this.options.decorators.forEach(function(t){t.decorate(this)},this)},onShow:function(){var t=this.ui.timestampLink[0];t&&S.set(t,"disableRouting",!0)},onRender:function(){this.updateRender(),this.timeChange()},timeChange:function(){var t=this.canEdit();this.$el.toggleClass("isEditable",this.isInEditablePeriod()),this.$el.toggleClass("canEdit",t)},_requiresFullRender:function(t){if(t&&"burstStart"in t){var e=!!this.model.previous("burstStart"),n=!!this.model.get("burstStart");if(n!==e)return!0}return!1},updateRender:function(t){if(this._requiresFullRender(t))return this.render();var e=this.ui.sent[0];if((!t||"html"in t||"text"in t)&&this.renderText(),t&&"id"in t&&e){var n=this.getPermalinkUrl();n.length&&e.setAttribute("href",n)}if(t&&"sent"in t&&e){var i=this.model.get("sent");if(i){var o=E(i);e.setAttribute("title",o)}}this.handleUpdateMentionChanges(t),this.handleUpdateMessageStateChanges(t),this.handleUpdateReadbyStateChanges(t),this.handleUpdateCollapseStateChanges(t),s.isLoggedIn()||this.ui.actions.hide()},handleUpdateMentionChanges:function(t){if(!t||"mentioned"in t){var e=this.model.get("mentioned");A(this.el,"mentioned",e),e&&(this.el.setAttribute("aria-live","assertive"),this.el.setAttribute("role","alert"))}},handleUpdateMessageStateChanges:function(t){var e=this.model;(!t||"fromUser"in t)&&A(this.el,"isViewers",this.isOwnMessage()),(!t||"editedAt"in t)&&A(this.el,"hasBeenEdited",this.hasBeenEdited()),(!t||"burstStart"in t)&&(A(this.el,"burstStart",!!e.get("burstStart")),A(this.el,"burstContinued",!e.get("burstStart"))),(!t||"burstFinal"in t)&&A(this.el,"burstFinal",!!e.get("burstFinal"))},handleUpdateReadbyStateChanges:function(t){if(t&&"readBy"in t){var e=this.model,n=e.get("readBy"),i=e.previous("readBy"),o=this.$el.find(".js-chat-item-readby"),r="chat-item__icon--read-by-some";0===o.length?n&&I(function(){o.addClass(r)}):0===i!=(0===n)&&o.toggleClass(r,!!n)}},handleUpdateCollapseStateChanges:function(t){if(t&&"collapsed"in t){var e=this.model.get("collapsed");e?this.collapseEmbeds():this.expandEmbeds()}if(!t||"isCollapsible"in t){var n=!!this.model.get("isCollapsible"),i=this.ui.collapse;L(i[0],n)}},focusInput:function(){i("#chat-input-textarea").focus()},onEditCancel:function(){d()||this.focusInput(),this.toggleEdit()},onEditSave:function(t){this.isEditing&&(this.canEdit()&&t!==this.model.get("text")&&(this.model.set("text",t),this.model.set("html",null),this.model.save()),d()||this.focusInput(),this.toggleEdit())},isOwnMessage:function(){return!!this.model.get("fromUser")&&this.model.get("fromUser").id===s.getUserId()},isInEditablePeriod:function(){var t=this.model.get("sent");if(!t)return!0;var e=Date.now()-t.valueOf();return e<=n},isEmbedded:function(){return s().embedded},canEdit:function(){return this.model.id&&this.isOwnMessage()&&this.isInEditablePeriod()&&!this.isEmbedded()},canDelete:function(){return this.model.id&&!this.isEmbedded()&&(this.isOwnMessage()||s.isTroupeAdmin())},hasBeenEdited:function(){return!!this.model.get("editedAt")},hasBeenRead:function(){return!!this.model.get("readBy")},onToggleEdit:function(){this.toggleEdit()},toggleEdit:function(){if(this.isEditing)this.isEditing=!1,this.showText(),this.stopListening(b,"focus.request.chat.edit"),b.trigger("chat.edit.hide");else if(this.canEdit()){var t=this;this.isEditing=!0,this.showInput(),this.listenTo(b,"focus.request.chat.edit",function(){t.inputBox.$el.focus(),b.trigger("focus.change.chat.edit")}),b.trigger("chat.edit.show")}},subst:function(t,e,n){if(this.canEdit()){var i=t.replace(/(^|[^\[])\^/g,"$1"),o=new RegExp(i,n?"gi":"i"),r=this.model.get("text").replace(o,e);this.model.set({text:r,html:null}).save()}},setCollapse:function(t){t=!!t;var e=this.model.get("id"),n=!!this.model.get("collapsed");t!==n&&(n?x.uncollapse(e):x.collapse(e),this.model.set("collapsed",!n))},onToggleCollapse:function(){this.toggleCollapse()},toggleCollapse:function(){var t=this.model.get("collapsed");this.setCollapse(!t)},collapseEmbeds:function(){var t=this,e=t.$el.find(".embed"),n=this.ui.collapse.find("i");clearTimeout(t.embedTimeout),this.ui.collapse.removeClass("chat-item__icon--collapse"),this.ui.collapse.addClass("chat-item__icon--expand"),n.removeClass("octicon-fold"),n.addClass("octicon-unfold"),t.rollers&&e.each(function(e,n){t.rollers.startTransition(n,500)}),e.css("overflow",void 0),e.css("max-height","0"),e.addClass("animateOut"),t.embedTimeout=setTimeout(function(){t.renderText()},600)},expandEmbeds:function(){function t(t){setTimeout(function(){t.each(function(t,n){var o=i(n).height();o<=e?i(n).css("max-height",o+"px"):i(n).css("overflow","hidden")})},3e3)}var n=this;clearTimeout(n.embedTimeout);var o=this.ui.collapse.find("i");o.addClass("octicon-fold"),o.removeClass("octicon-unfold"),this.ui.collapse.removeClass("chat-item__icon--expand"),this.ui.collapse.addClass("chat-item__icon--collapse"),n.expandFunction=function(e){
e.addClass("animateOut"),I(function(){n.rollers&&n.rollers.startTransition(e,500),e.removeClass("animateOut"),t(e)})},n.renderText(),n.embedTimeout=setTimeout(function(){var e=n.$el.find(".embed");n.rollers&&e.each(function(t,e){n.rollers.startTransition(e,500)}),e.removeClass("animateOut"),t(e)},10)},showText:function(){this.inputBox&&(this.stopListening(this.inputBox),this.inputBox.remove(),delete this.inputBox),this.renderText()},showInput:function(){var t=this.ui.text;t.html("<textarea class='trpChatInput' autofocus></textarea>");var e=this.model.get("text"),n=t.find("textarea").val(e);this.inputBox=new w({el:n}).render(),n.focus(),n.val("").val(e),this.listenTo(this.inputBox,"save",this.onEditSave),setTimeout(function(){n.focus(),n.val("").val(e)},0),this.listenTo(this.inputBox,"cancel",this.onEditCancel)},showReadByIntent:function(t){j.hoverTimeout(t,function(){this.showReadBy(t)},this)},showReadBy:function(t){if(!this.popover){var e=new j({model:this.model,userCollection:this.userCollection,scroller:this.$el.parents(".primary-scroll"),placement:"vertical",minHeight:"88px",width:"300px",title:"Read By",targetElement:t.target});e.show(),j.singleton(this,e),t.preventDefault(),t.stopPropagation()}},showActions:function(t){if(!this.popover){var e=new H({model:this.model,chatItemView:this,targetElement:t.target,placement:"horizontal",width:"100px"});this.listenTo(e,"render",function(){this.ui.actions.addClass("selected")}),this.listenTo(e,"destroy",function(){this.ui.actions.removeClass("selected")}),e.show(),j.singleton(this,e),t.preventDefault(),t.stopPropagation()}},mentionUser:function(){var t="@"+this.model.get("fromUser").username+" ";b.trigger("input.append",t)},permalink:function(t){this.isPermalinkable&&this.model.id&&(b.trigger("permalink.requested","chat",this.model,{appendInput:!!t.altKey}),t.preventDefault(),t.stopPropagation())},highlight:function(){var t=this;this.$el.addClass("chat-item__highlighted"),setTimeout(function(){t.$el.removeClass("chat-item__highlighted")},5e3)},onTouchstart:function(){this.isDragging=!1},onTouchmove:function(){this.isDragging=!0},onTouchend:function(){this.isDragging?this.isDragging=!1:this.onTap()},onTap:function(){var t=this.doubleTapper.registerTap();switch(t){case 1:this.triggerMethod("selected",this.model);break;case 2:this.toggleEdit()}},onTouchEditBlur:function(){this.inputBox&&this.toggleEdit()},onClick:function(t){var e=t.originalEvent;switch(e.detail){case 1:this.triggerMethod("selected",this.model);break;case 2:break;case 3:window.getSelection&&window.getSelection().selectAllChildren(this.el)}},onSyncStatusChange:function(t){this.$el.toggleClass("synced","synced"===t).toggleClass("syncing","syncing"===t).toggleClass("syncerror","syncerror"===t)},getPermalinkUrl:function(){if(!this.isPermalinkable)return"";var t=this.model.id;if(!t)return"";var e=s.troupe().get("uri");return e?a.basePath+"/"+e+"?at="+t:""},getSentTimeTooltip:function(){var t=this.model.get("sent");if(!t)return"";var e=t.format("LLL");return this.isPermalinkable&&e&&(e+="  <br>(Alt-click to quote)"),e},attachElContent:T.attachElContent}),O=u.CollectionView.extend({childView:c,className:"popoverReadBy",initialize:function(t){this.collection=new l.ReadByCollection(null,{listen:!0,chatMessageId:this.model.id,userCollection:t.userCollection}),this.collection.loading=!0},onDestroy:function(){var t=this.collection;this.stopListening(t),t.unlisten(),t.stopListening()}});y.mixin(O,k);var j=p.extend({initialize:function(t){p.prototype.initialize.apply(this,arguments),this.view=new O({model:this.model,userCollection:t.userCollection})}}),V=u.ItemView.extend({template:_,initialize:function(t){this.chatItemView=t.chatItemView},events:{"click .js-chat-action-collapse":"toggleCollapse","click .js-chat-action-expand":"toggleCollapse","click .js-chat-action-edit":"edit","click .js-chat-action-reply":"reply","click .js-chat-action-quote":"quote","click .js-chat-action-delete":"delete","click .js-chat-action-retry":"retry","click .js-chat-action-cancel":"cancel"},toggleCollapse:function(){this.chatItemView.triggerMethod("toggleCollapse")},edit:function(){this.chatItemView.triggerMethod("toggleEdit")},reply:function(){var t="@"+this.model.get("fromUser").username+" ";b.trigger("input.append",t)},quote:function(){b.trigger("input.append","> "+this.model.get("text"),{newLine:!0})},"delete":function(){this.model.destroy()},retry:function(){this.model.save()},cancel:function(){var t=this.model;t.id?t.fetch():t.collection.remove(t)},serializeData:function(){var t=this.model.hasSyncError();if(t)return{actions:[{name:"retry",description:"Retry"},{name:"cancel",description:"Cancel"}]};var e=!this.model.get("text"),n=!e&&this.model.get("isCollapsible"),i=!!this.model.id,o=!e&&this.chatItemView.canEdit()&&i,r=this.chatItemView.canDelete()&&i,s={actions:[{name:"reply",description:"Reply",disabled:!i}]};if(e||s.actions.push({name:"quote",description:"Quote",disabled:!i}),s.actions.push({name:"edit",description:"Edit",disabled:!o}),s.actions.push({name:"delete",description:"Delete",disabled:!r}),n){var a;a=this.model.get("collapsed")?{name:"expand",description:"Expand"}:{name:"collapse",description:"Collapse"},s.actions.push(a)}return s}}),H=p.extend({initialize:function(t){p.prototype.initialize.apply(this,arguments),this.view=new V({model:this.model,chatItemView:t.chatItemView})},events:{click:"hide"}});return{ChatItemView:D,ReadByView:O,ReadByPopover:j,ActionsView:V,ActionsPopover:H}}()},258:function(t,e,n){"use strict";var i=n(3),o=n(62),r=n(2),s=n(115),a=n(259),l=n(260),c=n(266),u=n(144),h=n(268),d=n(92);n(269);var f=64,m=30,p=d.getDefault();t.exports=function(){function t(t,e){t||(t=e.model?e.model.toJSON():e.user||{});var n,i=e.avatarSize||"s",o="m"===i?f:m,s=r.getUserId(),a=u(t,o),l=t.id===s||!!t.online;return n=e.showStatus?l?"online":"offline":"",{id:t.id,showStatus:e.showStatus,userDisplayName:t.displayName,alt:e.screenReadUsername?t.username:"",avatarSrcSet:a,avatarSize:i||"s",imgSize:o,presenceClass:n,online:l,offline:!l,role:t.role,invited:t.invited,removed:t.removed,inactive:t.removed||t.invited}}var e=o.ItemView.extend({tagName:"div",className:"avatar",template:a,events:{mouseover:"showDetailIntent",click:"showDetail","error img":"onImageError"},ui:{tooltip:":first-child",wrapper:".trpDisplayPicture",image:"img"},modelEvents:{change:"update"},behaviors:function(){var t=this.options;if(t.showTooltip!==!1)return{Tooltip:{":first-child":{titleFn:"getTooltip",placement:t.tooltipPlacement||"vertical"}}}},initialize:function(t){t.user&&(this.model=new i.Model(t.user))},onRender:function(){var t=this.ui.image[0];t&&(t.onerror=this.onImageError.bind(this))},onDestroy:function(){var t=this.ui.image[0];t&&(t.onerror=null)},showDetailIntent:function(t){l.hoverTimeout(t,function(){this.showDetail(t)},this)},showDetail:function(t){if(!s()&&(t.preventDefault(),!this.popover)){this.ui.tooltip.tooltip("hide");var e=this.model,n=new l({model:e,targetElement:t.target});n.show(),l.singleton(this,n)}},update:function(){var t=this.serializeData();this.updatePresence(t),this.updateAvatar(t)},updatePresence:function(t){if(this.options.showStatus){var e=this.ui.wrapper;e.toggleClass("online",t.online),e.toggleClass("offline",!t.online)}},updateAvatar:function(t){var e=this.ui.image[0],n=t.avatarSrcSet;e.src=n.src,e.srcset=n.srcset},getUserId:function(){return this.model.id},serializeData:function(){var e=this.options||{},n=this.model&&this.model.toJSON();return t(n,e)},getTooltip:function(){return this.model.get("displayName")},onImageError:function(t){var e=t.currentTarget;e.src!==p&&(e.src=p)},attachElContent:h.attachElContent});return e.getPrerendered=function(e,n){return"<span class='widget' data-widget-id='"+n+"'>"+a(t(null,e))+"</span>"},c.register({avatar:e}),e}()},259:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){var o;return this.escapeExpression((o=null!=(o=e.role||(null!=t?t.role:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"role",hash:{},data:i}):o))},3:function(t,e,n,i){return"invited"},5:function(t,e,n,i){return'<div class="trpStatus" id="status"> </div>'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,r,s,a=e.helperMissing,l="function",c=this.escapeExpression,u=this.lambda,h='<div\n  class="trpDisplayPicture avatar-'+c((r=null!=(r=e.id||(null!=t?t.id:t))?r:a,typeof r===l?r.call(t,{name:"id",hash:{},data:i}):r))+" avatar-"+c((r=null!=(r=e.avatarSize||(null!=t?t.avatarSize:t))?r:a,typeof r===l?r.call(t,{name:"avatarSize",hash:{},data:i}):r))+" "+c((r=null!=(r=e.presenceClass||(null!=t?t.presenceClass:t))?r:a,typeof r===l?r.call(t,{name:"presenceClass",hash:{},data:i}):r))+" "+(null!=(o=e["if"].call(t,null!=t?t.role:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+" "+(null!=(o=e["if"].call(t,null!=t?t.inactive:t,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?o:"")+'">\n  <img src="'+c(u(null!=(o=null!=t?t.avatarSrcSet:t)?o.src:o,t))+'" srcset="'+c(u(null!=(o=null!=t?t.avatarSrcSet:t)?o.srcset:o,t))+'" height="'+c((r=null!=(r=e.imgSize||(null!=t?t.imgSize:t))?r:a,typeof r===l?r.call(t,{name:"imgSize",hash:{},data:i}):r))+'" width="'+c((r=null!=(r=e.imgSize||(null!=t?t.imgSize:t))?r:a,typeof r===l?r.call(t,{name:"imgSize",hash:{},data:i}):r))+'" class="avatar__image" alt="'+c((r=null!=(r=e.alt||(null!=t?t.alt:t))?r:a,typeof r===l?r.call(t,{name:"alt",hash:{},data:i}):r))+'">\n  ';return r=null!=(r=e.showStatus||(null!=t?t.showStatus:t))?r:a,s={name:"showStatus",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i},o=typeof r===l?r.call(t,s):r,e.showStatus||(o=e.blockHelperMissing.call(t,o,s)),null!=o&&(h+=o),h+"\n</div>\n"},useData:!0})},260:function(t,e,n){"use strict";var i=n(62),o=n(3),r=n(261),s=n(264),a=n(265),l=n(52),c=n(2),u=n(239),h=n(92);t.exports=function(){var t=i.ItemView.extend({template:s,modelEvents:{change:"render"},serializeData:function(){var t=this.model.toJSON();return t.inactive=t.invited||t.removed,t.avatarUrl=h.getForUser(t),t}}),e=i.ItemView.extend({template:a,modelEvents:{change:"render"},events:{"click #button-onetoone":function(){this.parentPopover.hide();var t=this.model.get("username");l.trigger("navigation","/"+t,"chat",t,this.model.id)},"click #button-mention":function(){this.parentPopover.hide();var t=this.model.get("username");l.trigger("input.append","@"+t+" ")},"click #button-remove":function(){this.parentPopover.hide();var t=this.model.get("username");l.trigger("command.room.remove",t)}},serializeData:function(){var t=this.model.toJSON(),e=t.username!==c.user().get("username"),n=t.invited||t.removed,i=t.has_gitter_login&&e&&!n,o=e,r=e&&c.isTroupeAdmin();return c.inOneToOneTroupeContext()&&c.troupe().get("user").username===t.username&&(i=!1),t.avatarUrl=h.getForUser(t),t.inactive=t.invited||t.removed,t.chatPrivately=i,t.mentionable=o,t.removable=r,t.loaded=!!this.model.loaded,t}}),n=r.extend({initialize:function(n){n.placement="horizontal",n.minHeight="88px";var i;i=this.model?this.model.toJSON():{username:n.username,displayName:n.displayName};var s=i.username,a=new o.Model(i);a.sync=u.sync,a.url="/v1/users/"+s,a.fetch(function(){a.loaded=!0}),n.footerView=new e({model:a}),r.prototype.initialize.apply(this,arguments),this.view=new t({model:a,userCollection:n.userCollection})}});return n}()},261:function(t,e,n){"use strict";function i(t){for(var e=0;t&&t!=document;){var n=window.getComputedStyle(t,null);if(n){var i=n.getPropertyValue("z-index");i&&"auto"!==i&&(i=parseInt(i,10),i>e&&(e=i))}t=t.parentNode}return e}function o(t,e,n,i){var o;switch(t){case"bottom":o={top:e.top+e.height,left:e.left+e.width/2-n/2};break;case"top":o={top:e.top-i,left:e.left+e.width/2-n/2-2};break;case"left":o={top:e.top+e.height/2-i/2,right:document.body.clientWidth-e.left+u};break;case"right":o={top:e.top+e.height/2-i/2,left:e.left+e.width}}return o}var r=n(6),s=n(4),a=n(62),l=n(262),c=n(263),u=10,h=750,d={animation:!0,selector:!1,title:"",footerView:null,delay:300,container:!1,placement:"right",scroller:null,width:"",minHeight:""},f=a.ItemView.extend({template:c,className:"popover",initialize:function(t){s.bindAll(this,"leave","enter"),this.options=s.extend({},d,t),this.view=this.options.view,this.titleView=this.options.titleView,this.title=this.options.title,this.footerView=this.options.footerView,this.options.scroller&&(this.$scroller=r(this.options.scroller),this.scroller=this.$scroller[0]),this.targetElement=this.options.targetElement,this.$targetElement=r(this.targetElement),this.zIndex=i(this.targetElement),this.$targetElement.on("mouseenter",this.enter),this.$targetElement.on("mouseleave",this.leave),this.once("destroy",function(){this.mutant&&this.mutant.disconnect()})},serializeData:function(){return this.options},onRender:function(){var t=this.$el;this.view.parentPopover=this,this.zIndex&&(this.el.style.zIndex=this.zIndex+1),this.titleView?t.find(".popover-title").append(this.titleView.render().el):this.title?t.find(".popover-title").text(this.title):t.find(".popover-title").hide(),t.find(".popover-content").append(this.view.render().el),t.find(".popover-inner").css("width",this.options.width).css("min-height",this.options.minHeight);var e=this.footerView;e&&(e.parentPopover=this,t.find(".popover-footer-content").append(e.render().el)),t.on("mouseenter",this.enter),t.on("mouseleave",this.leave),t.addClass("popover-hidden"),t.removeClass("fade top bottom left right in")},enter:function(){this.timeout&&clearTimeout(this.timeout)},leave:function(){if(!this.options.delay)return t.hide();var t=this;this.timeout=setTimeout(function(){t.hide()},t.options.delay)},onDestroy:function(){this.$el.off("mouseenter",this.enter),this.$el.off("mouseleave",this.leave),this.$targetElement.off("mouseenter",this.enter),this.$targetElement.off("mouseleave",this.leave),this.titleView&&this.titleView.destroy(),this.view.destroy(),this.footerView&&this.footerView.destroy()},show:function(){var t=this.render().$el,e=this.el;t.detach().css({left:"auto",display:"block"}),t.appendTo(r("body")),this.reposition(),t.removeClass("popover-hidden"),this.mutant=new l(e,this.reposition,{scope:this,timeout:20,transitions:!0,observers:{attributes:!0,characterData:!0}})},reposition:function(){try{var t=this.$el,e=this.el,n=this.getTargetPosition();if(0===n.top&&0===n.left&&0===n.height&&0===n.width)return;var i=e.offsetWidth,r=e.offsetHeight,s=this.options.placement;switch(s){case"vertical":s=this.selectBestVerticalPlacement(t,this.targetElement);break;case"horizontal":s=this.selectBestHorizontalPlacement(t,this.targetElement)}var a=o(s,n,i,r);this.applyPlacement(a,s)}finally{this.mutant&&this.mutant.takeRecords()}},selectBestVerticalPlacement:function(t,e){var n=r(e);if(this.scroller){var i=this.scroller.scrollTop,o=this.scroller.scrollTop+this.scroller.clientHeight,s=(i+o)/2;return e.offsetTop>s?"top":"bottom"}var a=n.offsetParent();return a&&n.offset().top+t.height()+20>=a[0].clientHeight?"top":"bottom"},selectBestHorizontalPlacement:function(t,e){var n=e.getBoundingClientRect();return n.left<document.body.clientWidth/2?"right":"left"},applyPlacement:function(t,e){var n,i=this.$el,o=i[0],r=o.offsetWidth,s=o.offsetHeight,a=o.offsetWidth,l=o.offsetHeight,c=0;if("bottom"==e||"top"==e){if(t.left<0)c=-2*t.left,t.left=0;else if(t.left+a>window.innerWidth){var u=window.innerWidth-(t.left+a);c=2*u,t.left+=u}}else if(t.top<0)c=-2*t.top,t.top=0;else{var h=this.scroller?this.scroller.clientHeight:window.innerHeight;t.top+s>h&&(c=2*(h-t.top-s-10),t.top=h-s-10)}var d={top:t.top};t.right?(d.left="initial",d.right=t.right):(d.left=t.left,d.right="initial"),i.css(d).addClass(e).addClass("in"),"top"==e&&l!=s&&(t.top=t.top+s-l,n=!0),"bottom"==e||"top"==e?this.replaceArrow(c-r+a,a,"left"):this.replaceArrow(c-s+l,l,"top"),n&&i.offset(t)},replaceArrow:function(t,e,n){this.arrow().css(n,t?50*(1-t/e)+"%":"")},hide:function(){this.timeout&&clearTimeout(this.timeout);var t=this.$el;return t.removeClass("in"),t.addClass("popover-hidden"),setTimeout(function(){t.detach()},350),t.trigger("hidden"),this.trigger("hide"),this.destroy(),this},getTargetPosition:function(){var t=this.targetElement,e=s.extend({},t.getBoundingClientRect(),this.$targetElement.offset());return e},getTitle:function(){return this.options.title},arrow:function(){return this.$arrow||(this.$arrow=this.$el.find(".arrow")),this.$arrow}});f.hoverTimeout=function(t,e,n){var i=setTimeout(function(){i&&e.call(n,t)},h);r(t.target).one("mouseout click",function(){clearTimeout(i),i=null})},f.singleton=function(t,e){t.popover=e,t.listenToOnce(e,"hide",function(){t.popover=null})},t.exports=f},262:function(t,e,n){var i,o;!function(n){"use strict";function r(t,e,n){var i,o;return function(){var r=Date.now();i&&r<i+e?(clearTimeout(o),o=setTimeout(function(){i=r,t.apply(n)},e)):(i=r,t.apply(n))}}function s(t,e){return t.bind?t.bind(e):function(){var n=Array.prototype.slice.call(arguments);t.apply(e,n)}}function a(t,e){t||(t={});for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}function l(t){this._callback=t,this._onModifications=r(function(){this._callback([])},5,this)}function c(t,e,n){this.element=t,this.callback=e,this.context=n,t.addEventListener("load",this,!1),t.addEventListener("error",this,!1)}function u(t){var e=!(1!==t.nodeType||"IMG"!==t.tagName||t.complete||t.getAttribute("width")&&t.getAttribute("height"));return e}function h(t,e){return t.dataset?t.dataset[e]:t.getAttribute("data-"+e)}function d(t,e,n){return t.dataset?void(t.dataset[e]=n):t.setAttribute("data-"+e,n)}function f(t,e){return t.dataset?void delete t.dataset[e]:void t.removeAttribute(attrName)}function m(){var t=g.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var n in e)if(void 0!==t.style[n])return e[n]}function p(t,e,n){function i(){try{e.apply(l)}finally{o.takeRecords()}}var o=this;n||(n={}),o._eventHandlers={};var l=n.scope||null,c=n.timeout||0;o._transitionInterval=n.timeout||10;var u;u=c?r(i,c):i,o._callback=u,o._findLoadingImages(t),o._mutationCallback=s(o._mutationCallback,o),o.observer=new v(o._mutationCallback);var h=a(n.observers,{attributes:!1,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1});if(o.observer.observe(t,h),n.transitions){var d=n.ignoreTransitions&&n.ignoreTransitions.reduce(function(t,e){return t[e]=1,t},{});o._transitionEndHandler={target:t,handleEvent:function(t){o.endTransition(t.target),d&&d[t.propertyName]||u()}},t.addEventListener(w,o._transitionEndHandler,!1)}}l.prototype={observe:function(t){this._target=t,t.addEventListener("DOMSubtreeModified",this._onModifications,!1)},disconnect:function(){this._target&&(this._target.removeEventListener("DOMSubtreeModified",this._onModifications,!1),delete this._target)},takeRecords:function(){var t=this._target;this._target&&(t.removeEventListener("DOMSubtreeModified",this._onModifications,!1),t.addEventListener("DOMSubtreeModified",this._onModifications,!1))}},c.prototype={_detach:function(){this.element&&(this.element.removeEventListener("load",this,!1),this.element.removeEventListener("error",this,!1),this.element=null,this.callback=null,this.context=null)},handleEvent:function(t){this.callback.call(this.context,t,this)}};var g=n.document,v=n.MutationObserver||n.MozMutationObserver||n.WebKitMutationObserver||l,_=0,w=m();return p.prototype={_addListener:function(t){if(!h(t,"gLoadListenerId")){var e=++_;d(t,"gLoadListenerId",e),this._eventHandlers[e]=new c(t,function(t,e){e._detach(),this._callback()},this)}},_removeListener:function(t){var e=h(t,"gLoadListenerId");if(e){f(t,"gLoadListenerId");var n=this._eventHandlers[e];n&&(delete this._eventHandlers[e],n._detach())}},_mutationCallback:function(t){var e=this;t.forEach(function(t){var n;if("childList"===t.type){if(t.addedNodes)for(var i=0;i<t.addedNodes.length;i++)n=t.addedNodes[i],1===n.nodeType&&(n.children.length?e._findLoadingImages(n):u(n)&&e._addListener(n));if(t.removedNodes)for(var o=0;o<t.removedNodes.length;o++)n=t.removedNodes[o],1===n.nodeType&&(n.children.length||"IMG"===n.tagName&&e._removeListener(n))}}),this._callback()},_findLoadingImages:function(t){for(var e=t.querySelectorAll("img"),n=0;n<e.length;n++){var i=e[n];u(i)&&this._addListener(i)}},takeRecords:function(){return this.observer.takeRecords()},startTransition:function(t,e){var i=this,o=i._transitions;o?o.push(t):i._transitions=o=[t],e&&n.setTimeout(function(){i.endTransition(t)},e),1!==o.length||i._transitionTimer||(i._transitionTimer=n.setInterval(i._callback,i._transitionInterval))},endTransition:function(t){var e=this,i=e._transitions;if(i){for(var o=i.length-1;o>=0;o--)i[o]===t&&i.splice(o,1);0===i.length&&(delete e._transitions,n.clearTimeout(e._transitionTimer),delete e._transitionTimer)}},disconnect:function(){if(this.observer.disconnect(),this._transitionEndHandler){var t=this._transitionEndHandler.target;t.removeEventListener(w,this._transitionEndHandler,!1)}n.clearTimeout(self._transitionTimer);var e=this._eventHandlers;Object.keys(e).forEach(function(t){var n=e[t];n&&(delete e[t],n._detach())})}},n.Mutant=p,i=[],o=function(){return p}.apply(e,i),!(void 0!==o&&(t.exports=o)),p}(window)},263:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){return'<div class="popover-footer">\n  <div class="popover-footer-content"></div>\n</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return'<div>\n  <div class="arrow"></div>\n  <div class="popover-inner">\n    <h5 class="popover-title"></h5>\n    <div class="popover-content"></div>\n  </div>\n</div>\n'+(null!=(o=e["if"].call(t,null!=t?t.footerView:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")},useData:!0})},264:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){var o;return"  <div class='invited'>\n    <p><small>"+this.escapeExpression((o=null!=(o=e.username||(null!=t?t.username:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"username",hash:{},data:i}):o))+" is not on Gitter yet.</small></p>\n  </div>\n"},3:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'    <h3><a href="'+a((o=null!=(o=e.profile||(null!=t?t.profile:t))?o:r,typeof o===s?o.call(t,{name:"profile",hash:{},data:i}):o))+'" target="_blank" rel="nofollow noopener noreferrer">'+a((o=null!=(o=e.username||(null!=t?t.username:t))?o:r,typeof o===s?o.call(t,{name:"username",hash:{},data:i}):o))+"</a></h3>\n"},5:function(t,e,n,i){var o;return"    <h3>"+this.escapeExpression((o=null!=(o=e.username||(null!=t?t.username:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"username",hash:{},data:i}):o))+"</h3>\n"},7:function(t,e,n,i){var o,r=this.lambda,s=this.escapeExpression;return'    <div class="vcard-stats">\n        <strong class="vcard-stat-count">'+s(r(null!=(o=null!=t?t.github:t)?o.followers:o,t))+'</strong>\n        followers &nbsp;\n        <strong class="vcard-stat-count">'+s(r(null!=(o=null!=t?t.github:t)?o.public_repos:o,t))+'</strong>\n        repos &nbsp;\n        <strong class="vcard-stat-count">'+s(r(null!=(o=null!=t?t.github:t)?o.following:o,t))+"</strong>\n        following &nbsp;\n    </div>\n"},9:function(t,e,n,i){var o;return"      <li>\n        <div class='trpUserDetails__icon'>\n          <i class='octicon octicon-organization'></i>\n        </div>\n        <div class=\"trpUserDetails__text\">"+this.escapeExpression((o=null!=(o=e.company||(null!=t?t.company:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"company",hash:{},data:i}):o))+"</div>\n      </li>\n"},11:function(t,e,n,i){var o;return"      <li>\n        <div class='trpUserDetails__icon'>\n          <i class='octicon octicon-location'></i>\n        </div>\n        <div class=\"trpUserDetails__text\">"+this.escapeExpression((o=null!=(o=e.location||(null!=t?t.location:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"location",hash:{},data:i}):o))+"</div>\n      </li>\n"},13:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'      <li>\n        <div class=\'trpUserDetails__icon\'>\n          <i class=\'octicon octicon-mail\'></i>\n        </div>\n        <div class="trpUserDetails__text"><a class="email" href="mailto:'+a((o=null!=(o=e.email||(null!=t?t.email:t))?o:r,typeof o===s?o.call(t,{name:"email",hash:{},data:i}):o))+'">'+a((o=null!=(o=e.email||(null!=t?t.email:t))?o:r,typeof o===s?o.call(t,{name:"email",hash:{},data:i}):o))+"</a></div>\n      </li>\n"},15:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'      <li>\n        <div class=\'trpUserDetails__icon\'>\n          <i class=\'octicon octicon-link\'></i>\n        </div>\n        <div class="trpUserDetails__text"><a target="_blank" href="'+a((o=null!=(o=e.website||(null!=t?t.website:t))?o:r,typeof o===s?o.call(t,{name:"website",hash:{},data:i}):o))+'" class="url" rel="nofollow noreferrer noopener me">'+a((o=null!=(o=e.website||(null!=t?t.website:t))?o:r,typeof o===s?o.call(t,{name:"website",hash:{},data:i}):o))+"</a></div>\n      </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,r;return(null!=(o=e["if"].call(t,null!=t?t.inactive:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+'<div style="float: left"><img '+(null!=(o=e.avatarSrcSet.call(t,null!=t?t.avatarUrl:t,128,{name:"avatarSrcSet",hash:{},data:i}))?o:"")+' class="avatar-l"/></div>\n<div class="trpPopoverDetails">\n  <h2>'+this.escapeExpression((r=null!=(r=e.displayName||(null!=t?t.displayName:t))?r:e.helperMissing,"function"==typeof r?r.call(t,{name:"displayName",hash:{},data:i}):r))+"</h2>\n\n"+(null!=(o=e["if"].call(t,null!=t?t.profile:t,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?o:"")+"\n"+(null!=(o=e["if"].call(t,null!=t?t.github:t,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?o:"")+'\n  <ul class="trpUserDetails">\n'+(null!=(o=e["if"].call(t,null!=t?t.company:t,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?o:"")+"\n"+(null!=(o=e["if"].call(t,null!=t?t.location:t,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?o:"")+"\n"+(null!=(o=e["if"].call(t,null!=t?t.email:t,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?o:"")+"\n"+(null!=(o=e["if"].call(t,null!=t?t.website:t,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?o:"")+"  </ul>\n</div>\n"},useData:!0})},265:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){return'  <button class="trpBtnRed trpButtonSmall" id="button-remove">\n    Remove\n  </button>\n'},3:function(t,e,n,i){var o;return'  <button class="trpBtnLightGrey trpButtonSmall" id="button-mention">\n    Mention\n  </button>\n'+(null!=(o=e["if"].call(t,null!=t?t.profile:t,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?o:"")},4:function(t,e,n,i){var o;return'  <a href="'+this.escapeExpression((o=null!=(o=e.profile||(null!=t?t.profile:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"profile",hash:{},data:i}):o))+'" target="_blank" class="trpBtnLightGrey trpButtonSmall open-profile">Open Profile</a>\n'},6:function(t,e,n,i){return'  <button class="trpBtnGreen trpButtonSmall" id="button-onetoone">\n    Chat Privately\n  </button>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return(null!=(o=e["if"].call(t,null!=t?t.removable:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+(null!=(o=e["if"].call(t,null!=t?t.mentionable:t,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?o:"")+(null!=(o=e["if"].call(t,null!=t?t.chatPrivately:t,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?o:"")+"\n"},useData:!0})},266:function(t,e,n){"use strict";function i(t){var e=a.keys(t);a.each(e,function(e){var n=t[e];h[e]=n})}function o(){this._widgets=[]}function r(t,e,n){if(!t){var i="";if(n&&(i+=n.childViewContainer,n.$el.length>0)){var r=n.$el[0];r.id&&(i+="#"+r.id),r.classList.length>0&&(i+="."+Array.prototype.join(r.classList,"."))}throw new Error("Cannot render the template since it's false, null or undefined. For context, we tried to render into this element: "+i)}var s;s="function"==typeof t?t:l.TemplateCache.get(t);var a=s(e),c=e.prerenderedViews;if(!c)return a;var d=u(a),f=n.widgetManager,m=d.querySelectorAll(".widget"),p=m.length;p&&!f&&(f=new o,n.widgetManager=f);for(var g=0;g<p;g++){var v=m[g],_=v.getAttribute("data-widget-id");if(_){var w=c[_];if(w){v.removeAttribute("data-widget-id");var b=h[w.widgetName],y=w.model;y.el=v,y.template=!1;var x=new b(y);x.render(),f.add(x)}}}return d}function s(t,e,n){var i=h[t];return i.getPrerendered(e,n)}var a=n(4),l=n(62),c=n(98),u=n(267),h={};o.prototype.add=function(t){this._widgets.push(t)},o.prototype.destroy=function(){a.each(this._widgets,function(t){t.destroy()}),this._widgets=[]};var d=l.Behavior.extend({initialize:function(){if(this.view.templateHelpers)throw new Error("Cannot use templateHelpers with Widgets");this.view.templateHelpers=function(){return{_view:this,getPrerendered:s}}},onDestroy:function(){this.view.widgetManager&&(this.view.widgetManager.destroy(),this.view.widgetManager=null)}});l.Renderer={render:r},c.register("Widgets",d),t.exports={register:i,Behavior:d}},267:function(t,e){"use strict";t.exports=function(t){var e=document.createElement("DIV");e.innerHTML=t.trim();var n=e.children,i=n.length;if(1===i)return n[0];for(var o=document.createDocumentFragment(),r=0;r<i;r++)o.appendChild(n[0]);return o}},268:function(t,e){"use strict";function n(t){return"\n"===t||" "===t||"\t"===t}t.exports={attachElContent:function(t){var e=this.el;if("string"==typeof t)return e.innerHTML=t,this;if(t.length){e.innerHTML="";for(var i=t.length,o=0;o<i;o++){var r=t[o];3===r.nodeType&&1===r.textContent.length&&n(r.textContent[0])||e.appendChild(r)}return this}return 1===t.nodeType?(e.innerHTML="",e.appendChild(t),this):(this.$el.html(t),this)}}},269:function(t,e,n){"use strict";function i(t){a(function(){if(s(t,":hover")){var e;try{e=new MouseEvent("mouseover")}catch(n){e=document.createEvent("MouseEvents"),e.initMouseEvent("mouseover",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null)}t.dispatchEvent(e)}})}var o=n(62),r=n(98),s=n(270),a=n(57),l=n(83);n(271);var c=o.Behavior.extend({onRender:function(){if(!l()){this.destroyTooltips(),this.tooltips||(this.tooltips={}),this.handlers||(this.handlers={});var t=this;Object.keys(this.options).forEach(function(e){var n=""===e?t.$el:t.$el.find(e),o=n[0];if(o){var r=t.createHandler(n,o,e);o.addEventListener("mouseover",r,!1),t.handlers[e]=r,i(o)}})}},createHandler:function(t,e,n){var i=this;return{el:e,handleEvent:function(){e.removeEventListener("mouseover",this,!1),delete i.handlers[n],i.initTooltip(n,t,e)}}},initTooltip:function(t,e,n){var o=this.options[t],r=o.title||n.getAttribute("title");"function"==typeof o.titleFn?r=o.titleFn.bind(this.view)():o.titleFn&&(r=this.view[o.titleFn].bind(this.view)),this.tooltips[t]=e,e.tooltip({html:o.html,title:r,placement:o.placement,container:o.container||"body"});var s=o.customUpdateEvent;s&&this.view.on(s,this.updateTooltip.bind(this,e)),i(n)},onDestroy:function(){this.destroyHandlers(),this.destroyTooltips()},destroyHandlers:function(){var t=this.handlers;delete this.handlers,t&&Object.keys(t).forEach(function(e){var n=t[e],i=n.el;i.removeEventListener("mouseover",n,!1)})},destroyTooltips:function(){var t=this.tooltips;delete this.tooltips,t&&Object.keys(t).forEach(function(e){var n=t[e];n.tooltip("destroy")})},updateTooltip:function(t){t.tooltip("hide"),t.tooltip("show")}});r.register("Tooltip",c),t.exports=c},270:function(t,e){"use strict";var n=Element.prototype,i=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector;t.exports=function(t,e){return i.call(t,e)}},271:function(t,e,n){
"use strict";var i=n(6),o=n(115),r=n(83);t.exports=function(){return!function(t){var e=function(t,e){this.init("tooltip",t,e)};e.prototype={constructor:e,init:function(e,n,i){var r,s,a,l,c;for(this.type=e,this.$element=t(n),this.options=this.getOptions(i),this.enabled=!o(),a=this.options.trigger.split(" "),c=a.length;c--;)l=a[c],"click"==l?this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this)):"manual"!=l&&(r="hover"==l?"mouseenter":"focus",s="hover"==l?"mouseleave":"blur",this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.onenter,this)),this.$element.on(s+"."+this.type,this.options.selector,t.proxy(this.onleave,this)));this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(e){return e=t.extend({},t.fn[this.type].defaults,this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},onenter:function(t){this.enter(t.currentTarget)},enter:function(e){e=e||this.$element[0];var n,i=t.fn[this.type].defaults,o={};return this._options&&t.each(this._options,function(t,e){i[t]!=e&&(o[t]=e)},this),n=t(e)[this.type](o).data(this.type),n.hoverState="in",n.options.delay&&n.options.delay.show?(clearTimeout(this.timeout),void(this.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show))):n.show()},onleave:function(t){this.leave(t.currentTarget)},leave:function(e){e=e||this.$element[0];var n=t(e)[this.type](this._options).data(this.type);if("in"===n.hoverState)return n.hoverState="out",this.timeout&&clearTimeout(this.timeout),n.options.delay&&n.options.delay.hide?void(this.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide()},show:function(){var n,i,o,r,s,a,l=t.Event("show");if(e.prev&&e.prev!==this&&e.prev.hide(),e.prev=this,this.hasContent()&&this.enabled){if(this.$element.trigger(l),l.isDefaultPrevented())return;n=this.tip(),this.setContent(),this.options.animation&&n.addClass("fade"),s="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,n.detach().css({top:0,left:0,display:"block"}),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element),i=this.getPosition(),o=n[0].offsetWidth,r=n[0].offsetHeight,s=this.options.placement,"vertical"===s&&(s=this.selectBestVerticalPlacement(n,this.$element))}switch(s){case"bottom":a={top:i.top+i.height,left:i.left+i.width/2-o/2};break;case"top":a={top:i.top-r,left:i.left+i.width/2-o/2};break;case"left":a={top:i.top+i.height/2-r/2,left:i.left-o};break;case"right":a={top:i.top+i.height/2-r/2,left:i.left+i.width}}this.applyPlacement(a,s),this.$element.trigger("shown")},selectBestVerticalPlacement:function(t,e){var n=e[0].getBoundingClientRect();return n.top<60?"bottom":"top"},applyPlacement:function(t,e){var n,i,o,r,s=this.tip(),a=s[0].offsetWidth,l=s[0].offsetHeight;s.offset(t).addClass(e).addClass("in"),n=s[0].offsetWidth,i=s[0].offsetHeight,"top"==e&&i!=l&&(t.top=t.top+l-i,r=!0),"bottom"==e||"top"==e?(o=0,t.left<0&&(o=t.left*-2,t.left=0,s.offset(t),n=s[0].offsetWidth,i=s[0].offsetHeight),this.replaceArrow(o-a+n,n,"left")):this.replaceArrow(i-l,i,"top"),r&&s.offset(t)},replaceArrow:function(t,e,n){this.arrow().css(n,t?50*(1-t/e)+"%":"")},setContent:function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},hide:function(){function e(){var e=setTimeout(function(){n.off(t.support.transition.end).detach()},500);n.one(t.support.transition.end,function(){clearTimeout(e),n.detach()})}var n=this.tip(),i=t.Event("hide");if(this.$element.trigger(i),!i.isDefaultPrevented())return n.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?e():n.detach(),this.$element.trigger("hidden"),this},fixTitle:function(){var t=this.$element;t.attr("title")&&"string"!=typeof t.attr("data-original-title")&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var e=this.$element[0];return t.extend({},"function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight},this.$element.offset())},getTitle:function(){var t,e=this.$element,n=this.options;return t="function"==typeof n.title?n.title.call(e[0]):n.title},tip:function(){return this.$tip=this.$tip||t(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var n=e?t(e.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=t.fn.tooltip,i=r();t.fn.tooltip=function(n){if(!i)return this.each(function(){var i=t(this),o=i.data("tooltip"),r="object"==typeof n&&n;o||i.data("tooltip",o=new e(this,r)),"string"==typeof n&&o[n]()})},t.fn.tooltip.Constructor=e,t.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(i),i}()},272:function(t,e){"use strict";t.exports=function(t){var e=t||navigator.userAgent;return e.indexOf("Android")>-1}},273:function(t,e){"use strict";var n=350,i=function(){this._tapCount=0,this._timeout=null};i.prototype.registerTap=function(){var t=this;return this._tapCount++,clearTimeout(this._timeout),this._timeout=setTimeout(function(){t._tapCount=0},n),this._tapCount},t.exports=i},274:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){var o;return"  <div class='chat-item__aside'>\n    <div class=\"chat-item__avatar\">\n"+(null!=(o=e["if"].call(t,null!=t?t.fromUser:t,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?o:"")+"    </div>\n  </div>\n"},2:function(t,e,n,i){return"      "+this.escapeExpression((e.widget||t&&t.widget||e.helperMissing).call(t,"avatar",{name:"widget",hash:{user:null!=t?t.fromUser:t},data:i}))+"\n"},4:function(t,e,n,i){return'    <i class="chat-item__icon icon-check chat-item__icon--read chat-item__icon--read-by-some js-chat-item-readby"></i>\n'},6:function(t,e,n,i){return'    <i class="chat-item__icon icon-check chat-item__icon--read js-chat-item-readby"></i>\n'},8:function(t,e,n,i){return'      <div id=\'initial\' style="position:relative;top:-120px; left: 0; height:0;width:0;overflow:hidden"><a name="initial"/>_</a></div>\n'},10:function(t,e,n,i){var o,r,s=e.helperMissing,a="function",l=this.escapeExpression;return"    <div class='chat-item__details'>\n      <div class='chat-item__from js-chat-item-from'>"+l((r=null!=(r=e.displayName||(null!=t?t.displayName:t))?r:s,typeof r===a?r.call(t,{name:"displayName",hash:{},data:i}):r))+"</div>\n      <div class='chat-item__username js-chat-item-from'>@"+l((r=null!=(r=e.username||(null!=t?t.username:t))?r:s,typeof r===a?r.call(t,{name:"username",hash:{},data:i}):r))+"</div>\n      <a class='chat-item__time js-chat-time' "+(null!=(o=e["if"].call(t,null!=t?t.permalinkUrl:t,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?o:"")+' title="'+l((r=null!=(r=e.sentTimeFormattedFull||(null!=t?t.sentTimeFormattedFull:t))?r:s,typeof r===a?r.call(t,{name:"sentTimeFormattedFull",hash:{},data:i}):r))+'">'+l((r=null!=(r=e.sentTimeFormatted||(null!=t?t.sentTimeFormatted:t))?r:s,typeof r===a?r.call(t,{name:"sentTimeFormatted",hash:{},data:i}):r))+"</a>\n    </div>\n"},11:function(t,e,n,i){var o;return" href='"+this.escapeExpression((o=null!=(o=e.permalinkUrl||(null!=t?t.permalinkUrl:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"permalinkUrl",hash:{},data:i}):o))+"'"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,r;return"<div class='chat-item__container'>\n"+(null!=(o=e["if"].call(t,null!=t?t.burstStart:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+'  <div class="chat-item__actions js-chat-item-actions">\n'+(null!=(o=e["if"].call(t,null!=t?t.readByText:t,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?o:"")+"    <i class=\"chat-item__icon icon-ellipsis\"></i>\n  </div>\n  <div class='chat-item__content'>\n"+(null!=(o=e["if"].call(t,null!=t?t.initial:t,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?o:"")+(null!=(o=e["if"].call(t,null!=t?t.burstStart:t,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?o:"")+"    <div class='chat-item__text js-chat-item-text'>\n      "+(null!=(r=null!=(r=e.html||(null!=t?t.html:t))?r:e.helperMissing,o="function"==typeof r?r.call(t,{name:"html",hash:{},data:i}):r)?o:"")+"\n    </div>\n  </div>\n</div>\n"},useData:!0})},275:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){return'      <div id=\'initial\' style="position:relative;top:-120px; left: 0; height:0;width:0;overflow:hidden"><a name="initial"/>_</a></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,r,s=e.helperMissing,a="function";return"<div class='chat-item__container chat-item__status'>\n  <div class='chat-item__aside'>\n\n  </div>\n  <div class=\"chat-item__actions js-chat-item-actions\">\n    <i class=\"chat-item__icon icon-ellipsis\"></i>\n  </div>\n  <div class='chat-item__content'>\n"+(null!=(o=e["if"].call(t,null!=t?t.initial:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+"    <div class='chat-item__details'>\n      <div class='chat-item__text js-chat-item-text'>"+this.escapeExpression((r=null!=(r=e.username||(null!=t?t.username:t))?r:s,typeof r===a?r.call(t,{name:"username",hash:{},data:i}):r))+" "+(null!=(r=null!=(r=e.html||(null!=t?t.html:t))?r:s,o=typeof r===a?r.call(t,{name:"html",hash:{},data:i}):r)?o:"")+"</div>\n    </div>\n  </div>\n</div>\n"},useData:!0})},276:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){var o;return null!=(o=e["if"].call(t,null!=t?t.disabled:t,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?o:""},2:function(t,e,n,i){var o;return'    <div class="chat-item__action-disabled">\n      '+this.escapeExpression((o=null!=(o=e.description||(null!=t?t.description:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"description",hash:{},data:i}):o))+"\n    </div>\n"},4:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'    <div class="chat-item__action js-chat-action-'+a((o=null!=(o=e.name||(null!=t?t.name:t))?o:r,typeof o===s?o.call(t,{name:"name",hash:{},data:i}):o))+'">\n      '+a((o=null!=(o=e.description||(null!=t?t.description:t))?o:r,typeof o===s?o.call(t,{name:"description",hash:{},data:i}):o))+"\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return null!=(o=e.each.call(t,null!=t?t.actions:t,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:""},useData:!0})},277:function(t,e,n){"use strict";var i=n(62),o=n(52),r=n(255),s=n(278),a=n(187),l=n(115),c=n(57),u=i.ItemView.extend({template:!1,events:{textInput:"onTextInput",input:"onInput",blur:"onBlur"},keyboardEvents:{"chat.edit.escape":"onKeyEscape","chat.edit.send":"onKeySend"},onRender:function(){return r()&&this.$el.addClass("scroller"),this.onInput(),this},onInput:function(){this.$el.val()?this.expandTextareaIfNeeded():this.shrinkTextarea()},onBlur:function(){var t=this;l()?c(function(){t.trigger("cancel")}):this.resetTextareaSize()},onKeyEscape:function(){this.trigger("cancel")},onTextInput:function(t){var e=t.originalEvent,n=e.data;if(l()&&"\n"===n)return this.onKeySend(e)},onKeySend:function(t){this.trigger("save",this.$el.val()),t.preventDefault()},resetTextareaSize:function(){this.shrinkTextarea(),this.expandTextareaIfNeeded()},shrinkTextarea:function(){this.$el.css("height",""),o.trigger("chatCollectionView:viewportResize",!1)},expandTextareaIfNeeded:function(){var t=this.$el,e=t[0],n=e.offsetHeight,i=e.scrollHeight,r=window.innerHeight/2,s=Math.min(i,r);s>n&&(t.css("height",s),o.trigger("chatCollectionView:viewportResize",!0))}});a.mixin(u,s),t.exports=u},278:function(t,e,n){"use strict";var i=n(4),o=n(52);n(279),t.exports=function(){return{initialize:function(){var t;if(t=i.result(this,"keyboardEvents")){var e=this,n=/\s+/,r=function(t,n){i.isFunction(n)||(n=e[n]),n&&e.listenTo(o,"keyboard."+t,n,e)};i.each(t,function(t,e){if(n.test(e)){var o=e.split(n);i.each(o,function(e){r(e,t)})}else r(e,t)})}}}}()},279:function(t,e,n){"use strict";var i=n(52),o=n(280),r=n(4),s=n(282);t.exports=function(){function t(t){return"chat-input-textarea"===t.id?"input.chat":"list-search-input"===t.id||t.classList.contains("js-search-input")?"input.search":/^trpChatInput/.test(t.className)?"input.chat.edit":/^(INPUT|TEXTAREA|SELECT)$/.test(t.tagName)?"input.other":t.classList.contains("js-room-topic-edit-activator")?"button.room-topic-edit":t.classList.contains("js-profile-menu-toggle")?"button.profile-menu":t.classList.contains("room-menu-options__item-button")?"minibar.item":t.classList.contains("room-item__container")||t.classList.contains("js-left-menu-forum-category-item-link")?"room-list.item":"other"}var e=o.cmd,n=o.gitter;s.filter=function(e){var n=e.target||e.srcElement;if("on"===n.getAttribute("data-prevent-keys"))return!1;var i=t(n);return s.setScope(i),!0};var a={backspace:{name:"backspace",scope:"other"},esc:[{name:"chat.escape",scope:"input.chat"},{name:"chat.edit.escape",scope:"input.chat.edit"},{name:"search.escape",scope:"input.search"},{name:"maininput.escape",scope:["input.chat","input.search"]},{name:"input.escape",scope:"input.other"},{name:"document.escape",scope:"other"}],space:[{name:"room-topic.edit",scope:"button.room-topic-edit"},{name:"profile-menu.toggle",scope:"button.profile-menu"}],enter:[{name:"search.go",scope:"input.search"},{name:"chat.compose.auto",scope:"input.chat"},{name:"room-topic.edit",scope:"button.room-topic-edit"},{name:"profile-menu.toggle",scope:"button.profile-menu"}],"shift+enter":[{name:"chat.compose.auto",scope:"input.chat"}],up:[{name:"room.up",scope:"minibar.item"},{name:"room.up",scope:"room-list.item"},{name:"chat.edit.openLast",scope:"input.chat"},{name:"search.prev",scope:"input.search"}],down:[{name:"room.down",scope:"minibar.item"},{name:"room.down",scope:"room-list.item"},{name:"search.next",scope:"input.search"}],right:[{name:"room.next",scope:"minibar.item"},{name:"room.next",scope:"room-list.item"}],left:[{name:"room.prev",scope:"minibar.item"},{name:"room.prev",scope:"room-list.item"}],tab:[{name:"room.tab",scope:"minibar.item"},{name:"room.tab",scope:"room-list.item"}],"⇧+tab":[{name:"room.prev.tab",scope:"minibar.item"},{name:"room.prev.tab",scope:"room-list.item"}],pageup:"pageUp",pagedown:"pageDown","q, r":{name:"quote",scope:"other"},"shift+/,?":[{name:"help.keyboard",scope:"other"}]};a["enter, "+e+"+enter"]=[{name:"chat.send",scope:"input.chat"},{name:"chat.edit.send",scope:"input.chat.edit"}],a[e+"+/, "+e+"+"+n+"+/"]={name:"chat.toggle"},a[e+"++s"]="focus.search",a[e+"+"+n+"+c"]={name:"focus.chat",scope:"other"},a[e+"+"+n+"+m"]="help.markdown",a[e+"+"+n+"+k"]="help.keyboard",a[e+"+"+n+"+up"]={name:"room.up",scope:"other"},a[e+"+"+n+"+down"]={name:"room.down",scope:"other"},a[e+"+"+n+"+left"]={name:"room.prev",scope:"other"},a[e+"+"+n+"+right"]={name:"room.next",scope:"other"},a[e+"+"+n+"+enter"]={name:"room.enter",scope:"other"},r.each("123456789".split(""),function(t){a[e+"+"+n+"+"+t]="room."+t}),a[e+"+"+n+"+0"]="room.10";var l=function(t,e,n){r.isObject(e)&&(n=e.scope,e=e.name),n=n||"all";var o=function(n){s(t,n,function(t,n){i.trigger("keyboard."+e,t,n),i.trigger("keyboard.all",e,t,n)})};r.isArray(n)?r.each(n,o):o(n)};r.each(a,function(t,e){r.isArray(t)?r.each(t,function(t){l(e,t)}):l(e,t)})}()},280:function(t,e,n){"use strict";var i=n(281);t.exports=function(){switch(i()){case"Mac":return{cmd:"⌘",gitter:"ctrl"};case"Windows":return{cmd:"ctrl",gitter:"⇧"};default:return{cmd:"ctrl",gitter:"⇧+alt"}}}()},281:function(t,e){"use strict";t.exports=function(){return function(){var t=navigator.platform;return t.indexOf("Mac")>-1?"Mac":t.indexOf("Win")>-1?"Windows":t.indexOf("Linux")>-1?"Linux":void 0}}()},283:function(t,e,n){"use strict";var i=n(110);t.exports={collapse:function(t){i.userRoom.post("/collapsedItems",{chatId:t},{global:!1})},uncollapse:function(t){i.userRoom["delete"]("/collapsedItems/"+t,{},{global:!1})},collapseAll:function(t){t.each(function(t){t.get("isCollapsible")&&!t.get("collapsed")&&(t.set("collapsed",!0),i.userRoom.post("/collapsedItems",{chatId:t.id},{global:!1}))})}}},284:function(t,e,n){"use strict";var i=n(62),o=n(3),r=n(285),s=i.ItemView.extend({template:r});t.exports={loadingView:s,initialize:function(){this.showEmptyView=this.showLoadingView},showLoadingView:function(){if(this.collection.loading){var t=i.getOption(this,"loadingView");this.loadingModel||(this.loadingModel=new o.Model);var e=this.children.findByModel(this.loadingModel);return t&&!e&&(this.addChild(this.loadingModel,t,0),this.listenToOnce(this.collection,"loaded",function(){if(this.removeChildView(this.loadingModel),0===this.collection.length)return this.constructor.prototype.showEmptyView.call(this),!0})),!0}return this.constructor.prototype.showEmptyView.call(this),!0}}},285:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){return'<div class="trpLoading"></div>'},useData:!0})},286:function(t,e,n){"use strict";var i=n(147);t.exports=function(t,e){if(!t)return"";var n,o,r,s;e&&(n=e.lang,o=e.tzOffset,r=e.compact,s=e.now),t=i(t),n&&t.locale("en"===n?"en-gb":n),void 0!==o&&t.utcOffset(-o);var a=i(s).utcOffset(t.utcOffset());return t.date()===a.date()&&t.month()===a.month()&&t.year()===a.year()?t.format("HH:mm"):t.year()===a.year()?t.format(r?"MMM DD":"MMM DD HH:mm"):t.format(r?"MMM DD YYYY":"MMM DD YYYY HH:mm")}},287:function(t,e,n){"use strict";var i=n(147);t.exports=function(t,e){if(!t)return"";var n,o;return e&&(n=e.lang,o=e.tzOffset),t=i(t),n&&t.locale("en"===n?"en-gb":n),void 0!==o&&t.utcOffset(-o),t.format("LLL")}},288:function(t,e){"use strict";function n(t){var e=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});return"data-"+e.toLowerCase()}document.documentElement.dataset?t.exports={get:function(t,e){return t&&t.dataset&&t.dataset[e]},set:function(t,e,n){t.dataset[e]=n}}:t.exports={get:function(t,e){return t&&t.getAttribute(n(e))},set:function(t,e,i){return t.setAttribute(n(e),i)}}},289:function(t,e){"use strict";t.exports=function(t,e){t&&("none"===t.style.display?e&&(t.style.display=""):e||(t.style.display="none"))}},290:function(t,e,n){"use strict";function i(t){l.push(t),1===l.length&&setTimeout(o,500)}function o(){var t=l.shift();if(t){c<l.length&&(c=l.length);var e=t.classList;if(e.remove("unread"),l.length){var n=c>10?60:70;setTimeout(o,n)}else c=0}}var r=n(2),s=n(62),a=n(98),l=[],c=0,u=s.Behavior.extend({modelEvents:{"change:unread":"unreadChanged"},onRender:function(){if(r.isLoggedIn()){var t=this.view.model;if(t){var e=t.get("unread");e&&this.el.classList.add("unread")}}},unreadChanged:function(t,e,n){if(e)return void this.el.classList.add("unread");var o=t.previous("unread");o&&(n&&n.fast?(this.el.classList.add("fast"),this.el.classList.remove("unread")):i(this.el))}});a.register("UnreadItems",u),t.exports=u},291:function(t,e,n){"use strict";var i=n(62),o=n(292),r=n(98);t.exports=function(){var t=i.Behavior.extend({modelEvents:{"change:highlights":"onRender"},onRender:function(){if(this.view.model){var t=this.view.model.get("highlights");this.highlighted&&o.removeHighlights(this.view.el),t&&t.length&&(this.highlighted=!0,o.highlight(this.view.el,t))}}});return r.register("Highlight",t),t}()},292:function(t,e){"use strict";t.exports=function(){function t(t,e,n){var i=document.createElement("em");i.classList.add("highlight"),i.textContent=e,t.splitText(n),t.nextSibling.nodeValue=t.nextSibling.nodeValue.substr(e.length,t.nextSibling.nodeValue.length),i.appendChild(t.splitText(n)),t.parentNode.insertBefore(i,t.nextSibling)}function e(e,n){for(var i,o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,function(t){return 1!==t.nodeType?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),r=[];null!==(i=o.nextNode());)r.push(i);var s=n.map(function(t){var e=t.replace(/(^|[^\[])\^/g,"$1");return"("+e+")"}).join("|"),a=new RegExp(s,"gi");r.forEach(function(e){for(var n,i,o=[];null!==(n=a.exec(e.data));)o.push(n);for(var r=o.length;r-- >0;)n=o[r],t(e,n[0],n.index,i)})}function n(t){for(var e=t.querySelectorAll("em.highlight"),n=0;n<e.length;++n){var i=e[n],o=document.createTextNode(i.textContent);i.parentNode.replaceChild(o,i)}}return{highlight:e,removeHighlights:n}}()},293:function(t,e,n){"use strict";var i=n(62),o=n(98);t.exports=function(){var t=i.Behavior.extend({modelEvents:{"change:lastMessageSeen":"onRender"},onRender:function(){this.view.model&&this.view.model.get("lastMessageSeen")&&this.view.$el.addClass("lastMessageSeen")}});return o.register("LastMessageSeen",t),t}()},294:function(t,e,n){"use strict";function i(t){if(!t)return 0;var e=new Date,n=e.getFullYear(),i=e.getMonth(),o=e.getDate();return t instanceof Date&&t.getDate()===o&&t.getMonth()===i&&t.getFullYear()===n?u-t.getHours()*c+t.getMinutes()*l+t.getSeconds()*a+t.getMilliseconds():t.date&&t.date()===o&&t.month()===i&&t.year()===n?u-t.hour()*c+t.minute()*l+t.second()*a+t.millisecond():0}var o=n(62),r=n(98),s=n(286),a=1e3,l=60*a,c=60*l,u=24*c,h=o.Behavior.extend({defaults:{modelAttribute:null,el:null},ui:function(){return{time:this.options.el}},modelEvents:function(){var t={};return t["change:"+this.options.modelAttribute]="onTimeChange",t},initialize:function(){this.timer=null},onTimeChange:function(t){this.timer&&(clearTimeout(this.timer),this.timer=null);var e=t.get(this.options.modelAttribute),n=i(e);n>0&&(this.timer=setTimeout(this.onTimeChange.bind(this,t),n+1)),this.renderTime(e)},renderTime:function(t){var e=this.ui.time[0];if(e){var n=s(t,{compact:this.options.compact});e.textContent=n}},onDestroy:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}});r.register("TimeAgo",h),t.exports=h},295:function(t,e,n){"use strict";var i=n(262),o=n(4),r=n(234),s=n(115),a=n(232),l=n(57);t.exports=function(){function t(t,r,s){function c(){l(function(){h.trackLocation()})}s=s||{},this._target=t,this._childContainer=r||t,this._mutationHandlers={},this._mutationHandlers[e]=this.updateTrackBottom.bind(this),this._mutationHandlers[n]=this.updateStableTracking.bind(this),this._stableElement=null,s.doNotTrack?this._mode=n:this.initTrackingMode();var u=this.adjustScroll.bind(this);this.mutant=new i(t,u,{transitions:!0,observers:{attributes:!1,characterData:!1},ignoreTransitions:["opacity","background-color","border","color","border-right-color","visibility"]});var h=this,d=o.throttle(c,100);a.addEventListener(t,"scroll",d),window.addEventListener("resize",u,!1),window.addEventListener("focusin",u,!1),window.addEventListener("focusout",u,!1)}var e=1,n=3,c=10,u=300;return t.prototype={adjustScroll:function(){return this._mutationHandlers[this._mode](),this._postMutateTop=this._target.scrollTop,!0},adjustScrollContinuously:function(t){r.intervalUntil(this.adjustScroll.bind(this),t)},initTrackingMode:function(){this.isScrolledToBottom()?this._mode=e:this.stable()},stable:function(t){var e=this._target;if(this._mode=n,this._stableElement=t||this.getBottomMostVisibleElement(),this._stableElement){var i=e.scrollTop+e.clientHeight,o=this._stableElement.offsetTop-e.offsetTop;this._stableElementFromBottom=i-o}},setModeLocked:function(t){this.modeLocked=t,t||this.trackLocation()},disableTrackBottom:function(){this.disableTrackBottom=!0},enableTrackBottom:function(){this.disableTrackBottom=!0,this.isScrolledToBottom()&&this.trackLocation()},isScrolledToBottom:function(){var t=this._target,e=t.scrollTop>=t.scrollHeight-t.clientHeight-c;return e},updateTrackBottom:function(){var t=this._target,e=t.scrollHeight-t.clientHeight;this.scroll(e)},startTransition:function(t,e){this.mutant.startTransition(t,e)},endTransition:function(t){this.mutant.endTransition(t)},scrollToBottom:function(){var t=this._target,n=t.scrollHeight-t.clientHeight;this.scroll(n),delete this._stableElement,delete this._stableElementFromBottom,this._mode=e,this._postMutateTop=n},scrollToElement:function(t,e){var n,i=this._target;if(e&&e.centre){var o=t.offsetHeight,r=i.clientHeight;o<r&&(n=Math.floor(t.offsetTop+o/2-r/2))}n||(n=t.offsetTop-u),n<0&&(n=0),this.scroll(n),this.stable(t)},scrollToBottomContinuously:function(t){r.intervalUntil(this.scrollToBottom.bind(this),t)},updateStableTracking:function(){if(this._stableElement){var t=this._target,e=this._stableElement.offsetTop-t.offsetTop,n=e-t.clientHeight+this._stableElementFromBottom;this.scroll(n)}},trackLocation:function(){var t=this._target;if(this._postMutateTop===t.scrollTop)return!0;var i=t.scrollTop>=t.scrollHeight-t.clientHeight-c;if(this.modeLocked||(i?this._mode!=e&&(this._mode=e):this._mode!=n&&(this._mode=n)),this._mode===n){if(this._stableElement=this.getBottomMostVisibleElement(),!this._stableElement)return;var o=t.scrollTop+t.clientHeight,r=this._stableElement.offsetTop-t.offsetTop;this._stableElementFromBottom=o-r}return!0},getScrollBottom:function(){var t=this._target.scrollTop;return this._target.clientHeight+t},getBottomMostVisibleElement:function(){for(var t=this._target.scrollTop,e=this._target.clientHeight,n=t+e,i=this._childContainer.children,o=i.length-1;o>=0;o--){var r=i[o];if(r.offsetTop<n)return r}},getMostCenteredElement:function(){for(var t=this._target.scrollTop,e=this._target.clientHeight,n=t+e,i=this._childContainer.children,o=i.length-1;o>=0;o--){var r=i[o],s=e/2,a=n-r.offsetTop;if(a>s)return r}},scroll:function(t){s()?(this._target.style.overflow="hidden",this._target.scrollTop=t,this._target.style.overflow=""):this._target.scrollTop=t}},t}()},296:function(t,e,n){"use strict";var i=n(297),o=n(298);t.exports=function(t,e){return o(i,t,e)}},297:function(t,e){"use strict";t.exports={get:function(t,e){return t.get(e)},at:function(t,e){return t.at(e)},indexOf:function(t,e){return t.indexOf(e)}}},298:function(t,e){"use strict";function n(t,e,n){var i,o=t.indexOf(e,n),r=o+1,s=[n];if(o<0)return s;if(!t.get(n,"burstStart"))for(o--,i=t.at(e,o);o>=0&&(s.unshift(i),!t.get(i,"burstStart"));)o--,o>=0&&(i=t.at(e,o));for(;r<e.length&&(i=t.at(e,r))&&!t.get(i,"burstStart");)s.push(i),r++;return s}t.exports=n},299:function(t,e,n){"use strict";function i(){var t={};return{start:function(e){t[e]=Date.now()},end:function(e){var n=t[e];if(delete t[e],n)return s.trigger("stats.time",e,Date.now()-n),n}}}function o(){var t=window.performance,e={},n="gitter_";return setInterval(function(){var e=t.getEntriesByType("measure");if(e)for(var i=0;i<e.length;i++){var o=e[i];if(0!==o.name.indexOf(n))return;var r=o.name.substring(n.length),a=o.duration;a&&s.trigger("stats.time",r,a),t.clearMeasures(o.name)}},3e3),{start:function(i){e[i]=!0,t.mark(n+i+"_start")},end:function(i){var o,r=e[i];r?(delete e[i],o=n+i+"_start"):o=t.domContentLoadedEventStart;try{t.measure(n+i,o)}catch(s){}}}}var r,s=n(52);r=window.performance&&window.performance.mark&&window.performance.measure?o():i(),t.exports=r},300:function(t,e,n){"use strict";var i=n(62),o=n(98),r=n(301);t.exports=function(){var t=i.Behavior.extend({defaults:{reverseScrolling:!1,scrollElementSelector:null,contentWrapperSelector:null},initialize:function(){var t=this.options.scrollElement||document.querySelector(this.options.scrollElementSelector)||this.view.el,e=this.options.contentWrapper||document.querySelector(this.options.contentWrapperSelector),n=this.options.reverseScrolling,i=new r(t,{reverse:n,contentWrapper:e});this.listenTo(i,"approaching.top",function(){this.view.collection.fetchMoreBefore({})}),this.listenTo(i,"approaching.bottom",function(){this.view.collection.fetchMoreAfter({})}),this.scroll=i,this.view.scroll=i},onDestroy:function(){this.scroll.disable()}});return o.register("InfiniteScroll",t),t}()},301:function(t,e,n){"use strict";function i(t,e){this._target=t,this._reverse=e&&e.reverse,this._prevScrollTop=0,this._prevScrollTime=Date.now(),this._nearTop=!1,this._nearBottom=!1,this._scrollHandler=o.throttle(a()?this.mobileScroll.bind(this):this.scroll.bind(this),100),this._contentWrapper=e&&e.contentWrapper,this.enable()}var o=n(4),r=n(3),s=n(48)("app:nes"),a=n(115),l=n(232);o.extend(i.prototype,r.Events,{scroll:function(){var t=this._target,e=t.scrollTop,n=t.scrollHeight-t.scrollTop-t.clientHeight,i=this._prevScrollTop,o=this._prevScrollBottom;this._prevScrollTop=e,this._prevScrollBottom=n;var r=i-e,s=o-n,a=t.clientHeight/2,l=e<a,c=n<a;r>0&&l?this.trigger("approaching.top"):s>0&&c&&this.trigger("approaching.bottom"),this.scrollRate()},mobileScroll:function(){var t=this._target,e=t.scrollTop,n=t.scrollHeight-t.scrollTop-t.clientHeight,i=this._prevScrollTop,o=this._prevScrollBottom;this._prevScrollTop=e,this._prevScrollBottom=n;var r=i-e,s=o-n,a=e<=0,l=n<=0;r>0&&a?this.trigger("approaching.top"):s>0&&l&&this.trigger("approaching.bottom")},scrollRate:function(){var t=this._target,e=Date.now(),n=t.scrollTop,i=t.scrollHeight-t.scrollTop-t.clientHeight,o=this._prevScrollTimeRate,r=this._prevScrollTopRate,s=this._prevScrollBottomRate;if(this._prevScrollTopRate=n,this._prevScrollBottomRate=i,this._prevScrollTimeRate=e,o){var a,l,c=r-n,u=s-i,h=e-o;if(c>0){if(n>t.clientHeight)return;return a=c/h,l=n/a,void(l<600&&this.trigger("approaching.top"))}if(u>0){if(i>t.clientHeight)return;a=u/h,l=i/a,l<600&&this.trigger("approaching.bottom")}}},scrollToOrigin:function(){var t=this._target;if(this._reverse){var e=t.scrollHeight-t.clientHeight;t.scrollTop=e}else t.scrollTop=0;this._scrollHandler()},pageUp:function(){var t=this._target,e=t.scrollTop,n=Math.floor(.8*t.offsetHeight);t.scrollTop=e-n},pageDown:function(){var t=this._target,e=t.scrollTop,n=Math.floor(.8*t.offsetHeight);t.scrollTop=e+n},enable:function(){var t=this;this._enabled||(s("enabling scroll listener"),l.addEventListener(this._target,"scroll",this._scrollHandler),this._enabled=!0,this._contentWrapper&&setTimeout(function(){t._contentWrapper.offsetHeight<t._target.clientHeight&&t.trigger("approaching.top")},10))},disable:function(){this._enabled&&(s("disabling scroll listener"),l.removeEventListener(this._target,"scroll",this._scrollHandler),this._enabled=!1)}}),t.exports=i},302:function(t,e,n){"use strict";var i=n(62),o=n(98),r=n(4),s=n(234),a=n(232),l=i.Behavior.extend({defaults:{scrollElementSelector:null,contentWrapper:null},initialize:function(){var t=this.options.scrollElementSelector,e=this.options.contentWrapper;this.queue=[],this.scrollElement=t?document.querySelector(t):this.view.el,this.wrapper=e?this.scrollElement.querySelector(e):null,this.listenTo(this.view,"render",this.decorateIfVisible),this.lazyDecorator=r.debounce(this.decorateIfVisible.bind(this),500),this.lazyDecoratorQueue=s.debounce(this.decorateQueue,this),this.lazyTracker=r.debounce(this.trackViewport.bind(this),500),this.lazyPointerEvents=r.debounce(this.enablePointerEvents.bind(this),250),this.scrollHandler=this.smoothScroll.bind(this),a.addEventListener(this.scrollElement,"scroll",this.scrollHandler)},decorateIfVisible:function(){this.view.children.each(function(t){this.isElementVisible(t.el)&&t.trigger("messageInViewport")}.bind(this))},onAddChild:function(t){this.queue.push(t),this.lazyDecoratorQueue()},decorateQueue:function(){var t=this.queue;this.queue=[],t.forEach(function(t){this.isElementVisible(t.el)&&t.trigger("messageInViewport");
},this)},isElementVisible:function(t){var e=t.getBoundingClientRect();return e.bottom>=0&&e.top<=(window.innerHeight||document.documentElement.clientHeight)},trackViewport:function(){this.view.triggerMethod("trackViewportCenter")},disablePointerEvents:function(){this.wrapper&&!this.wrapper.classList.contains("disable-hover")&&this.wrapper.classList.add("disable-hover")},enablePointerEvents:function(){this.wrapper&&this.wrapper.classList.remove("disable-hover")},smoothScroll:function(){this.disablePointerEvents(),this.lazyDecorator(),this.lazyTracker(),this.lazyPointerEvents()},onDestroy:function(){a.removeEventListener(this.scrollElement,"scroll",this.scrollHandler)}});o.register("SmoothScroll",l),t.exports=l},303:function(t,e,n){"use strict";var i=n(3),o=n(62),r=n(304),s=n(52);n(269),t.exports=o.ItemView.extend({template:r,className:"chat-connectivity-indicator",model:new i.Model({hasConnectivity:!0}),ui:{indicator:".chat-connectivity-indicator"},behaviors:{Tooltip:{"#connectivity-icon":{title:"Realtime connection lost. Reconnecting...",placement:"bottom"}}},modelEvents:{change:"onConnectivityChange"},initialize:function(){this.listenTo(s,"realtime-connectivity:up",function(){this.model.set("hasConnectivity",!0)}),this.listenTo(s,"realtime-connectivity:down",function(){this.model.set("hasConnectivity",!1)})},onRender:function(){this.onConnectivityChange()},onConnectivityChange:function(){var t=this.model.get("hasConnectivity"),e=this.$el;clearTimeout(this.hideTimer),t?this.hideTimer=setTimeout(function(){e.hide()},1e3):e.show(),this.$el.toggleClass("is-hidden",t)}})},304:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){return'<span class="mega-octicon octicon-zap pulse" id="connectivity-icon" title="Reconnecting..."></span>\n'},useData:!0})},319:function(t,e,n){"use strict";var i=n(320);t.exports=function(){var t=i.emojify,e={decorate:function(e){t.run(e.$el.find(".js-chat-item-text")[0])}};return e}()},320:function(t,e,n){"use strict";var i=n(321),o=n(85);t.exports=function(){return i.setConfig({img_dir:o("images/emoji")}),{emojify:i,named:i.emojiNames}}()},321:function(t,e,n){var i,o,r;!function(n,s){"use strict";o=[],i=s,r="function"==typeof i?i.apply(e,o):i,!(void 0!==r&&(t.exports=r))}(this,function(){"use strict";var t=function(){function t(){var t={named:/:([a-z0-9A-Z_-]+):/,grinning:/:-?\)/g,smiley:/[:;]-?d/gi,wink:/;-?\)/g,worried:/:-?\(/g,sob:/:['’]-?\(|:&#x27;\(/g,confused:/:-?\//g,confounded:/:-?s/gi,stuck_out_tongue:/:-?p/gi,stuck_out_tongue_winking_eye:/;-?p/gi,open_mouth:/:-?o/gi,angry:/>:-?\(/gi,kissing:/:-?\*/g,expressionless:/:-?\|/g,mask:/:-x/gi,heart:/<3|&lt;3/g,broken_heart:/<\/3|&lt;&#x2F;3/g,thumbsup:/:\+1:/g,thumbsdown:/:\-1:/g};return p.ignore_emoticons&&(t={named:/:([a-z0-9A-Z_-]+):/,thumbsup:/:\+1:/g,thumbsdown:/:\-1:/g}),Object.keys(t).map(function(e){return[t[e],e]})}function e(){var t=c.map(function(t){var e=t[0],n=e.source||e;return n=n.replace(/(^|[^\[])\^/g,"$1"),"("+n+")"}).join("|");return new RegExp(t,"gi")}function n(t){return" "===t||"\t"===t||"\r"===t||"\n"===t||""===t}function i(t,e,n){var i=h.createElement(p.emojify_tag_type||"img");p.emojify_tag_type&&"img"!==p.emojify_tag_type?i.setAttribute("class","emoji emoji-"+n):(i.setAttribute("class","emoji"),i.setAttribute("src",p.img_dir+"/"+n+".png")),i.setAttribute("height","20"),i.setAttribute("width","20"),i.setAttribute("title",":"+n+":"),i.setAttribute("alt",":"+n+":"),i.setAttribute("align","absmiddle"),t.splitText(e.index),t.nextSibling.nodeValue=t.nextSibling.nodeValue.substr(e[0].length,t.nextSibling.nodeValue.length),i.appendChild(t.splitText(e.index)),t.parentNode.insertBefore(i,t.nextSibling)}function o(t){if(t[1]&&t[2]){var e=t[2];if(m[e])return e}else for(var n=3;n<t.length-1;n++)if(t[n])return c[n-2][1]}function r(t,e){return this.config.emojify_tag_type&&"img"!==this.config.emojify_tag_type?"<"+this.config.emojify_tag_type+" title=':"+e+":' alt=':"+e+":' class='emoji emoji-"+e+"'> </"+this.config.emojify_tag_type+">":"<img title=':"+e+":' alt=':"+e+":' class='emoji' src='"+this.config.img_dir+"/"+e+".png' align='absmiddle' />"}function s(){this.lastEmojiTerminatedAt=-1}function a(n,i){if(!n)return n;i||(i=r),c=t(),u=e();var o=new s;return n.replace(u,function(){var t=Array.prototype.slice.call(arguments,0,-2),e=arguments[arguments.length-2],n=arguments[arguments.length-1],r=o.validate(t,e,n);return r?i.apply({config:p},[arguments[0],r]):arguments[0]})}function l(n){c=t(),u=e(),"undefined"==typeof n&&(n=p.only_crawl_id?h.getElementById(p.only_crawl_id):h.body);for(var r,a=p.ignored_tags,l=h.createTreeWalker(n,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,function(t){return 1!==t.nodeType?NodeFilter.FILTER_ACCEPT:a[t.tagName]?NodeFilter.FILTER_REJECT:t.classList&&t.classList.contains("no-emojify")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP},!1),d=[];null!==(r=l.nextNode());)d.push(r);d.forEach(function(t){for(var e,n=[],r=new s;null!==(e=u.exec(t.data));)r.validate(e,e.index,e.input)&&n.push(e);for(var a=n.length;a-- >0;){var l=o(n[a]);i(t,n[a],l)}})}var c,u,h="undefined"!=typeof window&&window.document,d="+1,-1,100,1234,8ball,a,ab,abc,abcd,accept,aerial_tramway,airplane,alarm_clock,alien,ambulance,anchor,angel,anger,angry,anguished,ant,apple,aquarius,aries,arrow_backward,arrow_double_down,arrow_double_up,arrow_down,arrow_down_small,arrow_forward,arrow_heading_down,arrow_heading_up,arrow_left,arrow_lower_left,arrow_lower_right,arrow_right,arrow_right_hook,arrow_up,arrow_up_down,arrow_up_small,arrow_upper_left,arrow_upper_right,arrows_clockwise,arrows_counterclockwise,art,articulated_lorry,astonished,atm,b,baby,baby_bottle,baby_chick,baby_symbol,back,baggage_claim,balloon,ballot_box_with_check,bamboo,banana,bangbang,bank,bar_chart,barber,baseball,basketball,bath,bathtub,battery,bear,bee,beer,beers,beetle,beginner,bell,bento,bicyclist,bike,bikini,bird,birthday,black_circle,black_joker,black_medium_small_square,black_medium_square,black_nib,black_small_square,black_square,black_square_button,blossom,blowfish,blue_book,blue_car,blue_heart,blush,boar,boat,bomb,book,bookmark,bookmark_tabs,books,boom,boot,bouquet,bow,bowling,bowtie,boy,bread,bride_with_veil,bridge_at_night,briefcase,broken_heart,bug,bulb,bullettrain_front,bullettrain_side,bus,busstop,bust_in_silhouette,busts_in_silhouette,cactus,cake,calendar,calling,camel,camera,cancer,candy,capital_abcd,capricorn,car,card_index,carousel_horse,cat,cat2,cd,chart,chart_with_downwards_trend,chart_with_upwards_trend,checkered_flag,cherries,cherry_blossom,chestnut,chicken,children_crossing,chocolate_bar,christmas_tree,church,cinema,circus_tent,city_sunrise,city_sunset,cl,clap,clapper,clipboard,clock1,clock10,clock1030,clock11,clock1130,clock12,clock1230,clock130,clock2,clock230,clock3,clock330,clock4,clock430,clock5,clock530,clock6,clock630,clock7,clock730,clock8,clock830,clock9,clock930,closed_book,closed_lock_with_key,closed_umbrella,cloud,clubs,cn,cocktail,coffee,cold_sweat,collision,computer,confetti_ball,confounded,confused,congratulations,construction,construction_worker,convenience_store,cookie,cool,cop,copyright,corn,couple,couple_with_heart,couplekiss,cow,cow2,credit_card,crescent_moon,crocodile,crossed_flags,crown,cry,crying_cat_face,crystal_ball,cupid,curly_loop,currency_exchange,curry,custard,customs,cyclone,dancer,dancers,dango,dart,dash,date,de,deciduous_tree,department_store,diamond_shape_with_a_dot_inside,diamonds,disappointed,disappointed_relieved,dizzy,dizzy_face,do_not_litter,dog,dog2,dollar,dolls,dolphin,donut,door,doughnut,dragon,dragon_face,dress,dromedary_camel,droplet,dvd,e-mail,ear,ear_of_rice,earth_africa,earth_americas,earth_asia,egg,eggplant,eight,eight_pointed_black_star,eight_spoked_asterisk,electric_plug,elephant,email,end,envelope,es,euro,european_castle,european_post_office,evergreen_tree,exclamation,expressionless,eyeglasses,eyes,facepunch,factory,fallen_leaf,family,fast_forward,fax,fearful,feelsgood,feet,ferris_wheel,file_folder,finnadie,fire,fire_engine,fireworks,first_quarter_moon,first_quarter_moon_with_face,fish,fish_cake,fishing_pole_and_fish,fist,five,flags,flashlight,floppy_disk,flower_playing_cards,flushed,foggy,football,fork_and_knife,fountain,four,four_leaf_clover,fr,free,fried_shrimp,fries,frog,frowning,fu,fuelpump,full_moon,full_moon_with_face,game_die,gb,gem,gemini,ghost,gift,gift_heart,girl,globe_with_meridians,goat,goberserk,godmode,golf,grapes,green_apple,green_book,green_heart,grey_exclamation,grey_question,grimacing,grin,grinning,guardsman,guitar,gun,haircut,hamburger,hammer,hamster,hand,handbag,hankey,hash,hatched_chick,hatching_chick,headphones,hear_no_evil,heart,heart_decoration,heart_eyes,heart_eyes_cat,heartbeat,heartpulse,hearts,heavy_check_mark,heavy_division_sign,heavy_dollar_sign,heavy_exclamation_mark,heavy_minus_sign,heavy_multiplication_x,heavy_plus_sign,helicopter,herb,hibiscus,high_brightness,high_heel,hocho,honey_pot,honeybee,horse,horse_racing,hospital,hotel,hotsprings,hourglass,hourglass_flowing_sand,house,house_with_garden,hurtrealbad,hushed,ice_cream,icecream,id,ideograph_advantage,imp,inbox_tray,incoming_envelope,information_desk_person,information_source,innocent,interrobang,iphone,it,izakaya_lantern,jack_o_lantern,japan,japanese_castle,japanese_goblin,japanese_ogre,jeans,joy,joy_cat,jp,key,keycap_ten,kimono,kiss,kissing,kissing_cat,kissing_closed_eyes,kissing_face,kissing_heart,kissing_smiling_eyes,koala,koko,kr,large_blue_circle,large_blue_diamond,large_orange_diamond,last_quarter_moon,last_quarter_moon_with_face,laughing,leaves,ledger,left_luggage,left_right_arrow,leftwards_arrow_with_hook,lemon,leo,leopard,libra,light_rail,link,lips,lipstick,lock,lock_with_ink_pen,lollipop,loop,loudspeaker,love_hotel,love_letter,low_brightness,m,mag,mag_right,mahjong,mailbox,mailbox_closed,mailbox_with_mail,mailbox_with_no_mail,man,man_with_gua_pi_mao,man_with_turban,mans_shoe,maple_leaf,mask,massage,meat_on_bone,mega,melon,memo,mens,metal,metro,microphone,microscope,milky_way,minibus,minidisc,mobile_phone_off,money_with_wings,moneybag,monkey,monkey_face,monorail,mortar_board,mount_fuji,mountain_bicyclist,mountain_cableway,mountain_railway,mouse,mouse2,movie_camera,moyai,muscle,mushroom,musical_keyboard,musical_note,musical_score,mute,nail_care,name_badge,neckbeard,necktie,negative_squared_cross_mark,neutral_face,new,new_moon,new_moon_with_face,newspaper,ng,nine,no_bell,no_bicycles,no_entry,no_entry_sign,no_good,no_mobile_phones,no_mouth,no_pedestrians,no_smoking,non-potable_water,nose,notebook,notebook_with_decorative_cover,notes,nut_and_bolt,o,o2,ocean,octocat,octopus,oden,office,ok,ok_hand,ok_woman,older_man,older_woman,on,oncoming_automobile,oncoming_bus,oncoming_police_car,oncoming_taxi,one,open_file_folder,open_hands,open_mouth,ophiuchus,orange_book,outbox_tray,ox,package,page_facing_up,page_with_curl,pager,palm_tree,panda_face,paperclip,parking,part_alternation_mark,partly_sunny,passport_control,paw_prints,peach,pear,pencil,pencil2,penguin,pensive,performing_arts,persevere,person_frowning,person_with_blond_hair,person_with_pouting_face,phone,pig,pig2,pig_nose,pill,pineapple,pisces,pizza,plus1,point_down,point_left,point_right,point_up,point_up_2,police_car,poodle,poop,post_office,postal_horn,postbox,potable_water,pouch,poultry_leg,pound,pouting_cat,pray,princess,punch,purple_heart,purse,pushpin,put_litter_in_its_place,question,rabbit,rabbit2,racehorse,radio,radio_button,rage,rage1,rage2,rage3,rage4,railway_car,rainbow,raised_hand,raised_hands,raising_hand,ram,ramen,rat,recycle,red_car,red_circle,registered,relaxed,relieved,repeat,repeat_one,restroom,revolving_hearts,rewind,ribbon,rice,rice_ball,rice_cracker,rice_scene,ring,rocket,roller_coaster,rooster,rose,rotating_light,round_pushpin,rowboat,ru,rugby_football,runner,running,running_shirt_with_sash,sa,sagittarius,sailboat,sake,sandal,santa,satellite,satisfied,saxophone,school,school_satchel,scissors,scorpius,scream,scream_cat,scroll,seat,secret,see_no_evil,seedling,seven,shaved_ice,sheep,shell,ship,shipit,shirt,shit,shoe,shower,signal_strength,six,six_pointed_star,ski,skull,sleeping,sleepy,slot_machine,small_blue_diamond,small_orange_diamond,small_red_triangle,small_red_triangle_down,smile,smile_cat,smiley,smiley_cat,smiling_imp,smirk,smirk_cat,smoking,snail,snake,snowboarder,snowflake,snowman,sob,soccer,soon,sos,sound,space_invader,spades,spaghetti,sparkle,sparkler,sparkles,sparkling_heart,speak_no_evil,speaker,speech_balloon,speedboat,squirrel,star,star2,stars,station,statue_of_liberty,steam_locomotive,stew,straight_ruler,strawberry,stuck_out_tongue,stuck_out_tongue_closed_eyes,stuck_out_tongue_winking_eye,sun_with_face,sunflower,sunglasses,sunny,sunrise,sunrise_over_mountains,surfer,sushi,suspect,suspension_railway,sweat,sweat_drops,sweat_smile,sweet_potato,swimmer,symbols,syringe,tada,tanabata_tree,tangerine,taurus,taxi,tea,telephone,telephone_receiver,telescope,tennis,tent,thought_balloon,three,thumbsdown,thumbsup,ticket,tiger,tiger2,tired_face,tm,toilet,tokyo_tower,tomato,tongue,top,tophat,tractor,traffic_light,train,train2,tram,triangular_flag_on_post,triangular_ruler,trident,triumph,trolleybus,trollface,trophy,tropical_drink,tropical_fish,truck,trumpet,tshirt,tulip,turtle,tv,twisted_rightwards_arrows,two,two_hearts,two_men_holding_hands,two_women_holding_hands,u5272,u5408,u55b6,u6307,u6708,u6709,u6e80,u7121,u7533,u7981,u7a7a,uk,umbrella,unamused,underage,unlock,up,us,v,vertical_traffic_light,vhs,vibration_mode,video_camera,video_game,violin,virgo,volcano,vs,walking,waning_crescent_moon,waning_gibbous_moon,warning,watch,water_buffalo,watermelon,wave,wavy_dash,waxing_crescent_moon,waxing_gibbous_moon,wc,weary,wedding,whale,whale2,wheelchair,white_check_mark,white_circle,white_flower,white_large_square,white_medium_small_square,white_medium_square,white_small_square,white_square_button,wind_chime,wine_glass,wink,wolf,woman,womans_clothes,womans_hat,womens,worried,wrench,x,yellow_heart,yen,yum,zap,zero,zzz",f=d.split(/,/),m=f.reduce(function(t,e){return t[e]=!0,t},{}),p={emojify_tag_type:null,only_crawl_id:null,img_dir:"images/emoji",ignore_emoticons:!1,ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1,MATH:1}};return s.prototype={validate:function(t,e,i){function r(){return s.lastEmojiTerminatedAt=c+e,a}var s=this,a=o(t);if(a){var l=t[0],c=l.length;if(0===e)return r();if(i.length===l.length+e)return r();var u=this.lastEmojiTerminatedAt===e;if(u)return r();if(n(i.charAt(e-1)))return r();var h=n(i.charAt(l.length+e));return h&&u?r():void 0}}},{defaultConfig:p,emojiNames:f,setConfig:function(t){Object.keys(p).forEach(function(e){e in t&&(p[e]=t[e])})},replace:a,run:l}}();return t})},468:function(t,e,n){"use strict";function i(t){if(t){var e=t.split(":");return{offset:e[0],abbr:e[1],iana:e[2]}}}function o(t){var e=t.offset;return t.abbr&&(e+=":"+t.abbr),t.iana&&(e+=":"+t.iana),e}var r=n(469),s=n(470),a=r(),l=i(s.get("gitter_tz"));a.iana||l&&l.offset===a.offset&&l.abbr===a.abbr&&(a.iana=l.iana),l&&l.offset===a.offset&&l.abbr===a.abbr&&l.iana===a.iana||s.set("gitter_tz",o(a))},469:function(t,e){"use strict";function n(){try{return(new window.Intl.DateTimeFormat).resolvedOptions().timeZone}catch(t){return}}t.exports=function(){var t=new Date,e=t.toTimeString().match(/\(([^\)]+)\)/),i=e&&e[1]||"",o=t.getTimezoneOffset(),r=o>=0?"+":"-";o=Math.abs(o);var s=Math.floor(o/60),a=Math.round(o%60);return{offset:r+(s>9?s:"0"+s)+(a>9?a:"0"+a),iso:r+(s>9?s:"0"+s)+":"+(a>9?a:"0"+a),abbr:i,iana:n()}}},470:function(t,e){"use strict";var n="https:"===document.location.protocol;t.exports={get:function(t){return t?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},set:function(t,e){t&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(t)&&(document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; "+(n?"; secure":""))}}},471:function(t,e,n){"use strict";var i=n(110),o=n(48)("app:ping"),r=6e5;window.setInterval(function(){i.web.get("/api_web/private/ping",void 0,{global:!1})["catch"](function(t){o("An error occurred pinging the server: %j",t)})},r)},607:function(t,e,n){"use strict";var i=n(4),o=n(52),r=n(110),s=n(119),a=n(2),l=n(48)("app:stats");t.exports=function(){function t(){var t=n;n={};var i=e;if(e=[],i=i.concat(Object.keys(t).map(function(e){var n={stat:e};return t[e]>0&&(n.count=t[e]),n})),i.length){var o={stats:i,features:a.getFeatures()};r.priv.post("/statsc",o,{dataType:"text"})["catch"](function(){s.info("An error occurred while communicating stats")})}}var e=[],n={},c=i.throttle(t,1e3,{leading:!1});o.on("stats.event",function(t){l("event: %s",t),n[t]?n[t]++:n[t]=1,c()}),o.on("stats.gauge",function(t,n){l("gauge: %s: %s",t,n),e.push({stat:t,value:n}),c()}),o.on("stats.time",function(t,n){l("time: %s: %sms",t,n),e.push({stat:t,time:n}),c()})}()},608:function(t,e,n){"use strict";n(258)},609:function(t,e,n){"use strict";var i=n(2),o=n(52),r=n(610),s=i.user(),a=r({username:s&&s.get("username")}),l=!1;l&&window.addEventListener("unhandledrejection",function(t){t.preventDefault();var e=t.detail.reason;a(e)}),o.on("bugreport",function(t,e){o.trigger("stats.event","error"),a(t,e)})},610:function(t,e,n){"use strict";function i(t){return t.replace(/\/_s\/\w+\//,"/_s/l/")}function o(t){var e=r.ravenUrl;return e?(s.config(e,{release:r.version,dataCallback:function(t){try{t.stacktrace.frames.forEach(function(t){t.filename&&(t.filename=i(t.filename))}),t.culprit&&(t.culprit=i(t.culprit))}catch(e){}return t}}).install(),s.setUserContext({username:t.username}),function(t,e){return s.captureException(t,e)}):function(){}}var r=n(47),s=n(611);t.exports=o},636:function(t,e,n){"use strict";var i=n(52),o=n(48)("app:dozy");t.exports=function(){var t=12e4,e=1.5*t,n=Date.now();window.setInterval(function(){var t=Date.now(),r=t-n,s=r>e;n=t,s&&(o("Sleep detected!"),i.trigger("reawaken",r))},t)}()},650:function(t,e,n){"use strict";var i=n(62),o=n(68),r=n(254),s=n(651),a=n(655),l=n(658),c=n(659),u=n(319);n(97);var h=i.LayoutView.extend({template:!1,el:"body",dialogRegion:o,ui:{scroll:"#content-frame"},behaviors:{Isomorphic:{chat:{el:"#content-wrapper",init:"initChatRegion"}}},initChatRegion:function(t){var e=i.getOption(this,"monitorUnreadItems");return new r(t({collection:this.options.chatCollection,decorators:[s,a,l,c,u],monitorScrollPane:e&&this.ui.scroll}))}});t.exports=h},651:function(t,e,n){"use strict";function i(t){return t&&(t.providers||t.get("providers")).some(function(t){return"github"===t})}function o(t,e){var n=t;if("a"!==t.tagName){var i=document.createElement("a");if(i.innerHTML=t.innerHTML,t.parentNode.replaceChild(i,t),t.hasAttributes())for(var o=t.attributes,r=o.length-1;r>=0;r--){var s=o[r];i.setAttribute(s.name,s.value)}i.setAttribute("href",e||""),i.setAttribute("target","_blank"),n=i}return n}function r(t,e){return m.priv.get("/issue-state",{r:t,i:e}).then(function(t){return t[0]})}function s(){var t=f.troupe();if(!t)return u.reject("No current room");if(C)return C;var e,n=t.get("id");return C=new u(function(i,o){function r(){var e=t.get("id");if(n!==e)return o(new Error("Expired"));var r=t.get("associatedRepo");return r||r===!1?i(r||null):void 0}var s=t.get("associatedRepo");return s||s===!1?i(s||null):(e=function(){t.off("change",r)},void t.on("change",r))})["finally"](function(){e&&e()})}function a(t,e){return new v({titleView:new k({model:t}),view:new x({model:t}),footerView:new T({model:t}),targetElement:e,placement:"horizontal"})}function l(t,e){var n=f.troupe(),o=f.group(),r=o&&o.get("backedBy");if(t)return"https://github.com/"+t+"/issues/"+e;var s=f.user();if(!t&&n.get("oneToOne")){var a=n.get("user");if(s&&i(s)&&a&&i(a))return"https://github.com/issues?q="+e+"+%28involves%3A"+s.get("username")+"+OR+involves%3A"+a.username+"+%29"}return r&&"GH_ORG"===r.type?"https://github.com/issues?q="+e+"+user%3A"+r.linkPath:s&&i(s)?"https://github.com/issues?q="+e+"+involves:"+s.get("username"):"https://github.com/issues?q="+e}function c(t,e,n,i,o){function r(){var t=new E({repo:n,number:i,html_url:o});return t.fetch({data:{renderMarkdown:!0},error:function(){t.set({error:!0})}}),t}function s(e,n){n||(n=r());var i=a(n,e.target);i.show(),v.singleton(t,i),e.preventDefault()}function l(t){var e=r();v.hoverTimeout(t,function(){s(t,e)})}e.addEventListener("click",s),e.addEventListener("mouseover",l),t.once("destroy",function(){e.removeEventListener("click",s),e.removeEventListener("mouseover",l)})}var u=n(8),h=n(3),d=n(62),f=n(2),m=n(110),p=n(52),g=n(147),v=n(261),_=n(652),w=n(653),b=n(654),y=n(239),x=d.ItemView.extend({className:"issue-popover-body",template:_,modelEvents:{change:"render"},serializeData:function(){var t=this.model.toJSON();return t.date=g(t.created_at).format("LLL"),t}}),k=d.ItemView.extend({className:"issue-popover-title",modelEvents:{change:"render"},template:w}),T=d.ItemView.extend({className:"commit-popover-footer",template:b,events:{"click button.mention":"onMentionClick"},modelEvents:{change:"render"},onMentionClick:function(){s().then(function(t){var e=this.model.get("repo"),n=this.model.get("number"),i=e===t?"#"+n:e+"#"+n;p.trigger("input.append",i)}),this.parentPopover.hide()}}),C=null;f.troupe().on("change:id",function(){C=null});var E=h.Model.extend({idAttribute:"number",urlRoot:function(){var t=this.get("repo"),e="/private/gh/repos/"+t+"/issues/";return t||(e=m.room.uri("/issues")),e},sync:y.sync}),S={decorate:function(t){Array.prototype.forEach.call(t.el.querySelectorAll('*[data-link-type="issue"]'),function(e){return u["try"](function(){var t=e.dataset.issueRepo;return t?t:s()}).then(function(n){var i=e.dataset.issue,s=l(n,i)||"";e=o(e,s),n&&i&&r(n,i).then(function(o){o&&(e.classList.add("is-existent"),e.classList.contains("open")||e.classList.contains("closed")||e.classList.add(o),c(t,e,n,i,s))})})})}};t.exports=S},652:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){return"<div class=\"'chat-item__content'\">\n  Issue not found. It may not exist or you may not have access to it.\n</div>\n"},3:function(t,e,n,i){var o,r=this.lambda,s=this.escapeExpression;return'<div class="trpDisplayPicture--left avatar-s" style="background-image: url('+s(r(null!=(o=null!=t?t.user:t)?o.avatar_url:o,t))+');"></div>\n<div class=\'chat-item__content\'>\n  <div class="chat-item__details">\n    <div class="chat-item__from">'+s(r(null!=(o=null!=t?t.user:t)?o.login:o,t))+"</div>\n  </div>\n"+(null!=(o=e["if"].call(t,null!=t?t.body_html:t,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?o:"")+"</div>\n"+(null!=(o=e["if"].call(t,null!=t?t.assignee:t,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?o:"")},4:function(t,e,n,i){var o,r;return'    <div class="chat-item__text">'+(null!=(r=null!=(r=e.body_html||(null!=t?t.body_html:t))?r:e.helperMissing,o="function"==typeof r?r.call(t,{name:"body_html",hash:{},data:i}):r)?o:"")+"</div>\n"},6:function(t,e,n,i){return'    <div class="chat-item__text missing">No description given.</div>\n'},8:function(t,e,n,i){var o,r=this.lambda,s=this.escapeExpression;return'  <div style="float: right;\n  margin-top: 5px;\n  ">\n  <div class="trpDisplayPicture--left avatar-xxs" style="background-image: url('+s(r(null!=(o=null!=t?t.assignee:t)?o.avatar_url:o,t))+');\n                                                         vertical-align: middle;\n                                                         margin-top: 0.25em;\n                                                         margin-right: 0.25em;"></div>\n    <span style="\n    font-size: smaller;\n    vertical-align: middle;\n    color: #AAA;\n    ">'+s(r(null!=(o=null!=t?t.assignee:t)?o.login:o,t))+" is assigned</span>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return null!=(o=e["if"].call(t,null!=t?t.error:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?o:""},useData:!0})},653:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){var o;return": "+this.escapeExpression((o=null!=(o=e.title||(null!=t?t.title:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"title",hash:{},data:i}):o))},3:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'<span class="issuePopoverLabel issue '+a((o=null!=(o=e.state||(null!=t?t.state:t))?o:r,typeof o===s?o.call(t,{name:"state",hash:{},data:i}):o))+'">'+a((o=null!=(o=e.state||(null!=t?t.state:t))?o:r,typeof o===s?o.call(t,{name:"state",hash:{},data:i}):o))+"</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,r,s=e.helperMissing,a="function",l=this.escapeExpression;return'<a href="'+l((r=null!=(r=e.html_url||(null!=t?t.html_url:t))?r:s,typeof r===a?r.call(t,{name:"html_url",hash:{},data:i}):r))+'" target="_blank">#'+l((r=null!=(r=e.number||(null!=t?t.number:t))?r:s,typeof r===a?r.call(t,{name:"number",hash:{},data:i}):r))+(null!=(o=e["if"].call(t,null!=t?t.title:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+"</a>\n"+(null!=(o=e["if"].call(t,null!=t?t.state:t,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?o:"")},useData:!0})},654:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return'<button class="trpBtnLightGrey trpButtonSmall mention">Mention</button> <a href="'+this.escapeExpression((o=null!=(o=e.html_url||(null!=t?t.html_url:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"html_url",hash:{},data:i}):o))+'" target="_blank" class="trpBtnBlue trpButtonSmall open-in-github">Open in GitHub</a>\n'},useData:!0})},655:function(t,e,n){"use strict";var i=n(6),o=n(3),r=n(52),s=n(110),a=n(261),l=n(656),c=n(657),u=n(654),h=n(147),d=n(62);t.exports=function(){function t(t){if(1===t.split("/").length)return t.substring(0,f-1)+"…";for(var e=t;e.length>f-2;){var n=e.split("/");1===n.length?n[0]=n[0].substring(0,f-3)+"…":n.shift(),e=n.join("/")}return"…/"+e}function e(t,e){return new a({titleView:new p({model:t}),view:new m({model:t}),footerView:new g({model:t}),targetElement:e,placement:"horizontal"})}function n(t,e,n){s.priv.get("/gh/repos/"+t+"/commits/"+e,{renderPatchIfSingle:!0}).then(function(t){n.set(t)})["catch"](function(t){n.set("error",t.status)})}var f=40,m=d.ItemView.extend({className:"commit-popover-body",template:l,modelEvents:{change:"render"},serializeData:function(){var e=this.model.toJSON();return e.author&&(e.date=h(e.commit.author.date).format("LLL"),e.files.forEach(function(e){e.filename.length>f&&(e.fullFilename=e.filename,e.filename=t(e.filename))}),1===e.files.length&&(e.isFileLengthSingular=!0,e.files[0].patch_html&&(e.firstPatchHtml=e.files[0].patch_html)),1===e.stats.additions&&(e.isAdditionsSingular=!0),1===e.stats.deletions&&(e.isDeletionsSingular=!0)),e}}),p=d.ItemView.extend({className:"commit-popover-title",modelEvents:{change:"render"},template:c,serializeData:function(){var t=this.model.toJSON();return t.shortSha=t.sha.substring(0,7),t}}),g=d.ItemView.extend({className:"commit-popover-footer",template:u,modelEvents:{change:"render"},events:{"click button.mention":"onMentionClick"},onMentionClick:function(){var t=this.model.get("repo")+"@"+this.model.get("sha").substring(0,7);r.trigger("input.append",t),this.parentPopover.hide()}}),v={decorate:function(t){t.$el.find('*[data-link-type="commit"]').each(function(){function r(i){n(c,u,h);var o=e(h,i.target);o.show(),a.singleton(t,o)}function s(i){n(c,u,h),a.hoverTimeout(i,function(){var n=e(h,i.target);n.show(),a.singleton(t,n)})}var l=i(this),c=l.data("commitRepo"),u=l.data("commitSha");if(c&&u){var h=new o.Model({repo:c,sha:u,html_url:"https://github.com/"+c+"/commit/"+u});l.on("click",r),l.on("mouseover",s),t.once("destroy",function(){l.off("click",r),l.off("mouseover",s)})}})}};return v}()},656:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'Please check that:\n<ul>\n  <li><a href="https://github.com/'+a((o=null!=(o=e.repo||(null!=t?t.repo:t))?o:r,typeof o===s?o.call(t,{name:"repo",hash:{},data:i}):o))+"/commit/"+a((o=null!=(o=e.sha||(null!=t?t.sha:t))?o:r,typeof o===s?o.call(t,{name:"sha",hash:{},data:i}):o))+'" target="_blank" class="link">'+a((o=null!=(o=e.repo||(null!=t?t.repo:t))?o:r,typeof o===s?o.call(t,{name:"repo",hash:{},data:i}):o))+"@"+a((o=null!=(o=e.sha||(null!=t?t.sha:t))?o:r,typeof o===s?o.call(t,{name:"sha",hash:{},data:i}):o))+'</a> is a real commit</li>\n  <li>Gitter has <a href="https://github.com/settings/applications" target="_blank" class="link">permission to view it<a></li>\n</ul>\n'},3:function(t,e,n,i){var o;return null!=(o=e["if"].call(t,null!=t?t.author:t,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?o:""},4:function(t,e,n,i){var o,r=this.lambda,s=this.escapeExpression;return'<div class="trpDisplayPicture--left avatar-s" style="background-image: url('+s(r(null!=(o=null!=t?t.author:t)?o.avatar_url:o,t))+');"></div>\n<div class=\'chat-item__content\'>\n  <div class="chat-item__details">\n    <div class="chat-item__from">'+s(r(null!=(o=null!=t?t.author:t)?o.login:o,t))+'</div>\n  </div>\n  <div class="chat-item__text">\n    <p>'+s(r(null!=(o=null!=t?t.files:t)?o.length:o,t))+" file"+(null!=(o=e.unless.call(t,null!=t?t.isFileLengthSingular:t,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?o:"")+" changed. "+s(r(null!=(o=null!=t?t.stats:t)?o.additions:o,t))+" addition"+(null!=(o=e.unless.call(t,null!=t?t.isAdditionsSingular:t,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?o:"")+", "+s(r(null!=(o=null!=t?t.stats:t)?o.deletions:o,t))+" deletion"+(null!=(o=e.unless.call(t,null!=t?t.isDeletionsSingular:t,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?o:"")+'.</p>\n    <ul class="file-list">\n'+(null!=(o=e.each.call(t,null!=t?t.files:t,{name:"each",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?o:"")+"    </ul>\n"+(null!=(o=e["if"].call(t,null!=t?t.firstPatchHtml:t,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?o:"")+"  </div>\n</div>\n"},5:function(t,e,n,i){return"s"},7:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return'      <li><a href="'+a((o=null!=(o=e.blob_url||(null!=t?t.blob_url:t))?o:r,typeof o===s?o.call(t,{name:"blob_url",hash:{},data:i}):o))+'" target="_blank" class="'+a((o=null!=(o=e.status||(null!=t?t.status:t))?o:r,typeof o===s?o.call(t,{name:"status",hash:{},data:i}):o))+'" title="'+a((o=null!=(o=e.fullFilename||(null!=t?t.fullFilename:t))?o:r,typeof o===s?o.call(t,{name:"fullFilename",hash:{},data:i}):o))+'">'+a((o=null!=(o=e.filename||(null!=t?t.filename:t))?o:r,typeof o===s?o.call(t,{name:"filename",hash:{},data:i}):o))+"</a></li>\n"},9:function(t,e,n,i){var o,r;return"      "+(null!=(r=null!=(r=e.firstPatchHtml||(null!=t?t.firstPatchHtml:t))?r:e.helperMissing,o="function"==typeof r?r.call(t,{name:"firstPatchHtml",hash:{},data:i}):r)?o:"")+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return null!=(o=e["if"].call(t,null!=t?t.error:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?o:""},useData:!0})},657:function(t,e,n){var i=n(72);t.exports=(i["default"]||i).template({1:function(t,e,n,i){return"  Error - Commit Not Found\n"},3:function(t,e,n,i){var o;return null!=(o=e["if"].call(t,null!=t?t.commit:t,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?o:""},4:function(t,e,n,i){var o;return"    "+this.escapeExpression(this.lambda(null!=(o=null!=t?t.commit:t)?o.message:o,t))+"\n"},6:function(t,e,n,i){var o,r=e.helperMissing,s="function",a=this.escapeExpression;return"    "+a((o=null!=(o=e.repo||(null!=t?t.repo:t))?o:r,typeof o===s?o.call(t,{name:"repo",
hash:{},data:i}):o))+"@"+a((o=null!=(o=e.shortSha||(null!=t?t.shortSha:t))?o:r,typeof o===s?o.call(t,{name:"shortSha",hash:{},data:i}):o))+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,r;return'<a href="'+this.escapeExpression((r=null!=(r=e.html_url||(null!=t?t.html_url:t))?r:e.helperMissing,"function"==typeof r?r.call(t,{name:"html_url",hash:{},data:i}):r))+'" target="_blank">\n'+(null!=(o=e["if"].call(t,null!=t?t.error:t,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?o:"")+"</a>"},useData:!0})},658:function(t,e,n){"use strict";var i=n(2),o=n(260),r=n(288);t.exports=function(){function t(t){var e=t.model.get("mentions"),n=i.user();if(e&&n){var o=i.user().get("username");o&&e.some(function(t){return t.userId===i.getUserId()})&&t.$el.find(".trpChatBox").addClass("mention")}}var e={decorate:function(e){function n(t){var n=r.get(t.target,"screenName");if(n){var i=new o({username:n,targetElement:t.target});i.show(),o.singleton(e,i)}}function i(t){o.hoverTimeout(t,function(){n(t)})}var s=e.$el.find(".mention");s.on("click",n),s.on("mouseover",i),e.once("destroy",function(){s.off("click",n),s.off("mouseover",i)}),t(e)}};return e}()},659:function(t,e,n){"use strict";var i=n(660),o=n(661);t.exports=function(){function t(t){var e=t.model;if(e.get("collapsed"))return void e.set("isCollapsible",!0);var n=!1;t.$el.find("a.link").each(function(r,s){0===s.childElementCount&&(s.innerText||s.textContent)===s.href&&o.parse(s.href,function(o){if(o&&o.html){n||(e.set("isCollapsible",!0),n=!0);var r;r="string"==typeof o.html?i(i.parseHTML(o.html,null,!0)):o.html;var a=i(document.createElement("div"));a.addClass("embed"),t.expandFunction&&t.expandFunction(a),o.maxWidth&&a.css({"max-width":o.maxWidth+"px"}),a.html(r),i(s).after(a),i.iframely.registerIframesIn(a)}})})}var e={decorate:function(e){t(e)}};return e}()},660:function(t,e,n){var i=n(6);!function(t){function e(e,n){var i=n.media;if(i&&i.height&&i.width&&!i["aspect-ratio"])return e.attr("width",i.width),e.attr("height",i.height),e;e.css("top",0).css("left",0).css("width","100%").css("height","100%").css("position","absolute");var o=t("<div>").css("left",0).css("width","100%").css("height",0).css("position","relative").append(e);if(i&&(i.height||i["aspect-ratio"])||o.css("padding-bottom","56.25%"),i&&(i["aspect-ratio"]?o.css("padding-bottom",Math.round(1e5/i["aspect-ratio"])/1e3+"%"):(i.height&&o.css("height",i.height),i.width&&o.css("width",i.width)),i["max-width"]||i["min-width"])){var r=t("<div>").append(o);["max-width","min-width"].forEach(function(t){i[t]&&r.css(t,i[t])}),o=r}return o}function n(t){if(t){if(t instanceof Array)return t.length>0?t[0]:void 0;if("object"==typeof t)for(var e in t){var n=t[e];if(n instanceof Array&&n.length>0)return n[0]}}}var i=function(){return{postMessage:function(t,e,n){t=JSON.stringify(t),e=e||"*",n=n||window.parent,window.postMessage&&n.postMessage(t,e.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))},receiveMessage:function(t){function e(e){var n;try{n=JSON.parse(e.data)}catch(i){}t(e,n)}window.postMessage&&(window.addEventListener?window[t?"addEventListener":"removeEventListener"]("message",e,!1):window[t?"attachEvent":"detachEvent"]("onmessage",e))}}}();t.ajaxPrefilter("script",function(t){t.url.indexOf("reader.js")>-1&&(t.cache=!0)}),t.iframely=t.iframely||{},t.iframely.iframes=t.iframely.iframes||{},i.receiveMessage(function(e,n){var i;n&&n.windowId&&(i=t.iframely.iframes[n.windowId])&&t.iframely.setIframeHeight&&"resize"===n.method&&n.height&&t.iframely.setIframeHeight(i,n.height)}),t.iframely.setIframeHeight=function(t,e){var n=t.attr("iframely-wrapped"),i=t.parent();if("undefined"==typeof n){var o=i.attr("style"),r=t.attr("style");o&&r&&o.match("position: relative;")&&o.match("height: 0px;")&&r.match("height: 100%;")&&r.match("width: 100%;")?(t.attr("iframely-wrapped",!0),n=!0):(t.attr("iframely-wrapped",!1),n=!1)}n?i.css("padding-bottom","").css("height",e):t.css("height",e)},t.iframely.registerIframesIn=function(e){e.find("iframe").each(function(){var e=t(this);t.iframely.registerIframe(e)})},t.iframely.registerIframe=function(e,n){e&&!e.attr("iframely-registered")&&(e.attr("iframely-registered",!0),e.load(function(){var o=t.iframely.iframesCounter=(t.iframely.iframesCounter||0)+1,r=n||o;t.iframely.iframes[r]=e,i.postMessage({method:"register",windowId:r},"*",this.contentWindow)}))},t.iframely.getPageData=function(e,n,i){"function"==typeof n&&(i=n,n={}),n=n||{},t.support.cors=!0,t.ajax({crossDomain:!0,url:t.iframely.defaults.endpoint,dataType:"json",data:{uri:n.url?void 0:e,url:n.url?e:void 0,debug:n.debug,mixAllWithDomainPlugin:n.mixAllWithDomainPlugin,refresh:n.refresh,meta:n.meta,whitelist:n.whitelist,api_key:n.api_key,origin:n.origin,autoplay:n.autoplay,ssl:n.ssl,html5:n.html5,iframe:n.iframe},success:function(t,e,n){i(null,t,n)},error:function(t,e,n){var o=function(){try{return JSON.parse(t.responseText)}catch(e){}}();i(e,o,t)}})},t.iframely.defaults={endpoint:"//iframely.com/iframely"},t.iframely.get=function(e,n,i){t.ajax({url:e,dataType:"json",data:n,success:function(t,e,n){i(null,t,n)},error:function(t,e,n){var o=function(){try{return JSON.parse(t.responseText)}catch(e){}}();i(o&&o.error||t.status||n.message,o,t)}})};var o={javascript:{test:function(t){return/(text|application)\/javascript/i.test(t.type)&&t.href},generate:function(e){return t("<script>").attr("type",e.type).attr("src",e.href)}},image:{test:function(t){return/^image(\/[\w\.-]+)?$/i.test(t.type)&&t.href},generate:function(e){var n=t("<img>").attr("src",e.href);return e.title&&n.attr("title",e.title).attr("alt",e.title),n}},mp4video:{test:function(t){return"video/mp4"==t.type||"video/webm"==t.type||"video/ogg"==t.type},generate:function(n,i){var r=i&&i.iframelyData,s=n.rel.indexOf("gifv")>-1,a=n.rel.indexOf("autoplay")>-1||s,l=t("<video"+(s?" loop muted webkit-playsinline":" controls")+(a?" autoplay":"")+">Your browser does not support HTML5 video.</video>");if(r&&r.links){var c,u,h=n.media;h&&(c=h["aspect-ratio"],c||[["min-width","min-height"],["max-width","max-height"],["width","height"]].forEach(function(t){u=h[t[0]];var e=h[t[1]];u&&e&&(c=u/e)}));var d=t.iframely.filterLinks(r.links,function(t){return t.rel.indexOf("promo")>-1}).length,f=t.iframely.filterLinks(r.links,function(t){if((!d||t.rel.indexOf("promo")!==-1)&&o.image.test(t)&&(t.rel.indexOf("thumbnail")>-1||t.rel.indexOf("image")>-1)&&t.type.indexOf("gif")===-1&&!t.href.match(/\.gif(?:[#\?].*)?$/i)){var e=t.media;if(c&&e&&e.width&&e.height){var n=e.width/e.height;return Math.abs(n-c)<.15}return!0}});f.sort(function(t,e){var n=t.media&&t.media.width,i=e.media&&e.media.width;return n==i?0:n&&i?i-n:n?i?void 0:-1:1}),f.length&&l.attr("poster",f[0].href)}return l.append("<source />").children("source").attr("src",n.href).attr("type",n.type),i&&i.disableSizeWrapper?l:e(l,n)}},flash:{test:function(t){return"application/x-shockwave-flash"===t.type&&t.href},generate:function(n,i){var o=t("<embed>").attr("src",n.href).attr("type","application/x-shockwave-flash");return i&&i.disableSizeWrapper?o:e(o,n)}},iframe:{test:function(t){return"text/html"==t.type&&t.href},generate:function(n,i){var o=t("<iframe>").attr("src",n.href).attr("frameborder","0").attr("allowfullscreen",!0).attr("webkitallowfullscreen",!0).attr("mozallowfullscreen",!0);return i&&i.disableSizeWrapper?o:e(o,n)}},inline:{test:function(t){return"text/html"===t.type&&t.rel.indexOf("inline")>-1&&!t.href&&t.html},generate:function(e,n){var i;try{i=t(e.html)}catch(o){i=t("<div>").append(e.html)}return i}}};t.iframely.generateLinkElement=function(t,e){e&&e.links&&(e={iframelyData:e});for(var n in o){var i=o[n];if(i.test(t))return i.generate(t,e)}},t.iframely.findBestFittedLink=function(e,i,o){var r=t.iframely.filterLinks(o,function(t){var e=t.media;return e&&e.width&&e.height});if(0==r.length)return n(o);var s=e/i,a=[];r.forEach(function(t){var n,o=t.media.width,r=t.media.height,l=o/r;n=l>s?o/e:r/i,n>1&&(o/=n,r/=n);var c=e*i-o*r;a.push({link:t,scale:n,modScale:n>1?n:1/n,diffSquare:c})});var l,c=a.filter(function(t){return t.scale<=1});c.length>0&&(c.sort(function(t,e){return e.scale-t.scale}),l=c[0]);var u,h=a.filter(function(t){return t.scale>1});h.length>0&&(h.sort(function(t,e){var n=t.diffSquare-t.diffSquare;return 0==n&&(n=t.scale-e.scale),n}),u=h[0]);var d=[l,u].filter(function(t){return t});return d.sort(function(t,e){return t.modScale-e.modScale}),d[0].link},t.iframely.findBestSizedLink=function(e,i,o){var r=t.iframely.filterLinks(o,function(t){var e=t.media;return e&&e.width&&e.height});if(0==r.length)return n(o);var s=[];r.forEach(function(t){var n=t.media.width,o=t.media.height,r=n-e,a=o-i,l=0,c=0;r>0&&a>0&&(l=n*o-e*i),r<0&&a<0&&(c=e*i-n*o),r>0&&a<0&&(l=r*o,c=-a*e),r<0&&a>0&&(l=a*n,c=-r*i),s.push({link:t,overSquare:l,lostSquare:c})});var a=s.filter(function(t){return 0==t.lostSquare});if(a.length>0)return a.sort(function(t,e){return t.overSquare-e.overSquare}),a[0].link;var l=s.filter(function(t){return t.lostSquare>0});return l.sort(function(t,e){return t.lostSquare-e.lostSquare}),l[0].link},t.iframely.filterLinksByRel=function(e,n,i){function o(t){return/^(?:https:)?\/\/.+/i.test(t)}var i=i||{};"string"==typeof e&&(e=[e]);var r=t.iframely.filterLinks(n,function(t){if(i.httpsOnly&&!o(t.href))return!1;for(var n=!1,r=0;!n&&r<e.length;)t.rel.indexOf(e[r])>-1&&(n=!0),r++;return n});return r&&i.httpsFirst&&r.sort(function(t,e){var n=o(t.href),i=o(e.href);return n==i?0:n&&!i?-1:1}),r&&i.returnOne?r.length>0?r[0]:null:r},t.iframely.filterLinks=function(t,e){if(t){if(t instanceof Array)return t.filter(e);if("object"==typeof t){var n=[];for(var i in t){var o=t[i];o instanceof Array&&o.forEach(function(t){e(t)&&n.push(t)})}return n}}return[]}}(i),t.exports=i},661:function(t,e,n){"use strict";function i(t,e){u.iframely.getPageData(t,{lazy:1,autoplay:!1,ssl:!0,iframe:!0,html5:!0},function(t,n){return t?e(null):void a(n,e)})}function o(t,e){var n=e.filter(function(e){return e.rel.indexOf(t)>=0});if(n.length){if(1==n.length)return n[0];var i=n.filter(function(t){return t.rel.indexOf("responsive")>=0});if(i.length>=1)return i[0];var o=n.filter(function(t){return t.media&&t.media["aspect-ratio"]>0});return o.length>=1?o[0]:n[0]}}function r(t,e){var n=e.filter(function(e){return e.rel.indexOf(t)>=0});if(n.length)return n.sort(function(t,e){var n=Math.abs((t.media&&t.media.height||0)-f),i=Math.abs((e.media&&e.media.height||0)-f);return n-i}),n[0]}function s(t){for(var e=["player","app","reader","survey"],n=0;n<e.length;n++){var i=o(e[n],t);if(i)return i}var s=r("image",t);return s?s:(s=r("thumbnail",t),s?s:void 0)}function a(t,e){var n=s(t.links);if(!n)return e(null);var i=u.iframely.generateLinkElement(n,t),o=n.media&&n.media["aspect-ratio"],r=o&&Math.floor(o*f);e({html:i,maxWidth:r})}function l(t,e){var n=t.match(/https?:\/\/(.+)(\.jpe?g|\.gif|\.png)$/i);c(t)||n?i(t,e):e(null)}function c(t){return d.some(function(e){return t.match(e)})}var u=n(6);n(660);var h=n(47),d=["youtube.com","www.youtube.com","youtu.be","instagram.com","instagr.am","cloudup.com","cl.ly","dl.dropboxusercontent.com","www.dropbox.com/s","codepen.io","gist.github.com","vine.co","goo.gl","twitter.com","soundcloud.com","snd.sc","rd.io","rdio.com","www.mixcloud.com","www.meetup.com","www.dailymotion.com","meetu.ps","open.spotify.com","stream.tv/recorded","photobucket.com","www.slideshare.net","speakerdeck.com","www.behance.net","dribbble.com","vimeo.com","www.flickr.com","www.twitch.tv","flic.kr","500px.com"].map(function(t){if("object"==typeof t)return t;var e=t.replace(/[\.\/]/g,function(t){return"\\"+t[0]});return new RegExp("https?:\\/\\/"+e+"\\/.+")}),f=640,m=h.embed||{};u.iframely.defaults.endpoint=m.basepath+"/"+m.cacheBuster+"/iframely",t.exports={parse:l}}});
//# sourceMappingURL=http://beta-internal:8080/job/gitter-webapp-build-step/10760/artifact/output/maps/router-nli-embed-chat.js.map
